<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Airline Staff Portal</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0063c6">
    <meta name="description" content="Essential tools for airline staff - flight tracking, airport info, and quick links">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AA Staff Portal">
    <meta name="application-name" content="AA Staff Portal">

    <!-- Base64 Icons -->
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSIjMDA2M2M2IiBkPSJNNTAsMTBMOTAsOTBIMTBMNTAsMTB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCw3NWwtMjUtMTBoNTBMNTAsNzV6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCwyNWwxNSw0NUg2NWwtMTUtNDV6Ii8+PC9zdmc+">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEwMCIgZmlsbD0iIzAwNjNjNiIvPjxwYXRoIGZpbGw9IndoaXRlIiBkPSJNMjU2LDEwMEwzOTAsMzgwSDEyMkwyNTYsMTAweiIvPjxwYXRoIGZpbGw9IiNlNDAwNDYiIGQ9Ik0yNTYsMzIwbC0zNS0xOGg3MEwyNTYsMzIweiIvPjxwYXRoIGZpbGw9IiNlNDAwNDYiIGQ9Ik0yNTYsMTUwbDIwLDcwaDIwbC0yMC03MHoiLz48L3N2Zz4=">

    <!-- Inline Manifest (properly escaped JSON) -->
    <link rel="manifest" id="manifest-placeholder">

    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Inline CSS -->
    <style>
        :root {
            --primary-color: #0063c6;
            --primary-dark: #004d9e;
            --primary-light: #e6f0ff;
            --accent-color: #e40046;
            --accent-dark: #b80039;
            --accent-light: #ffe6ed;
            --text-color: #1e293b;
            --text-light: #64748b;
            --text-dark: #0f172a;
            --background-color: #f8fafc;
            --card-color: #ffffff;
            --card-hover: #f1f5f9;
            --border-color: #e2e8f0;
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            --box-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        }

        /* Dark Mode Variables */
        .dark-mode {
            --primary-color: #0284c7;
            --primary-dark: #0369a1;
            --primary-light: #0c4a6e;
            --text-color: #f1f5f9;
            --text-light: #94a3b8;
            --text-dark: #e2e8f0;
            --background-color: #0f172a;
            --card-color: #1e293b;
            --card-hover: #334155;
            --border-color: #334155;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --box-shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-family);
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            padding: env(safe-area-inset-top, 20px) env(safe-area-inset-right, 20px) env(safe-area-inset-bottom, 20px) env(safe-area-inset-left, 20px);
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            transition: background-color 0.3s ease;
            line-height: 1.5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 10px;
            transition: var(--transition);
        }

        /* Header Styles */
        .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-text {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary-color);
            letter-spacing: -0.5px;
            transition: var(--transition);
        }

        .logo-icon {
            color: var(--accent-color);
            font-size: 1.4rem;
            transition: var(--transition);
        }

        /* Toggle Switches */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 22px;
            margin: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            z-index: 1;
        }
        
        .theme-toggle .toggle-slider {
            background-color: #87ceeb; /* light sky blue */
            overflow: visible;
        }
        
        .theme-toggle .toggle-slider:before {
            background-color: white;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }
        
        .theme-toggle .light-icon, 
        .theme-toggle .dark-icon {
            position: absolute;
            font-size: 10px;
            top: 50%;
            transform: translateY(-50%);
            transition: .4s;
            z-index: 2;
        }
        
        .theme-toggle .light-icon {
            left: 6px;
            color: #0063c6; /* blue departure plane */
            opacity: 1;
            transform: translateY(-50%) rotate(-45deg);
        }
        
        .theme-toggle .dark-icon {
            right: 6px;
            color: white; /* white arrival plane */
            opacity: 0;
            transform: translateY(-50%) rotate(45deg);
        }
        
        input:checked + .toggle-slider {
            background-color: #1a365d; /* dark blue night sky */
        }

        input:focus + .toggle-slider {
            box-shadow: 0 0 1px var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        input:checked + .toggle-slider .light-icon {
            opacity: 0;
        }
        
        input:checked + .toggle-slider .dark-icon {
            opacity: 1;
        }
        
        /* Theme Selector */
        .theme-selector {
            display: flex;
            gap: 8px;
        }
        
        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            background-color: var(--primary-light);
        }
        
        .theme-btn:hover {
            transform: translateY(-2px);
        }
        
        .theme-btn.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 99, 198, 0.3);
        }
        
        .light-theme {
            background-color: #87CEEB;
            color: #0063c6;
        }
        
        .dark-theme {
            background-color: #1a365d;
            color: white;
        }
        
        .aa-theme {
            background-color: #0078D2; /* American Airlines Blue */
            color: white;
        }
        
        /* American Airlines Theme CSS Variables */
        .aa-mode {
            --primary-color: #0078D2; /* American Airlines Blue */
            --primary-dark: #00509B;
            --primary-light: #E6F1F9;
            --accent-color: #C8102E; /* American Airlines Red */
            --accent-dark: #A7000A;
            --text-color: #003366;
            --text-light: #5C7C99;
            --background-color: #F5F7FA;
            --card-color: #FFFFFF;
            --card-hover: #F0F4F8;
            --border-color: #D1DCE8;
        }
        
        /* Enhanced American Airlines Theme Styling */
        .aa-mode {
            background-image: 
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100' fill='%230078D2' fill-opacity='0.03'%3E%3Cpath d='M21,16V14L13,9V3.5A1.5,1.5,0,0,0,11.5,2h0A1.5,1.5,0,0,0,10,3.5V9L2,14v2l8-2.5V19l-2,1.5V22l3.5-1h1L13,22V20.5l-2-1.5V13.5Z'/%3E%3C/svg%3E"),
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200' fill='%23C8102E' fill-opacity='0.02'%3E%3Cpath d='M100,0 L200,200 L0,200 Z'/%3E%3C/svg%3E");
            background-attachment: fixed;
        }
        
        .aa-mode .header-row {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1440' height='200' preserveAspectRatio='none' viewBox='0 0 1440 200'%3E%3Cpath fill='%230078D2' d='M0,120L80,105C160,90,320,60,480,70C640,80,800,130,960,140C1120,150,1280,120,1360,105L1440,90L1440,0L1360,0C1280,0,1120,0,960,0C800,0,640,0,480,0C320,0,160,0,80,0L0,0Z'%3E%3C/path%3E%3C/svg%3E");
            background-color: #0057A5;
            background-size: cover;
            margin: -10px -10px 16px -10px;
            padding: 15px 20px 30px 20px;
            border-radius: 0;
            border-bottom: 3px solid #C8102E;
            position: relative;
        }
        
        .aa-mode .header-row::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            right: 0;
            height: 5px;
            background: repeating-linear-gradient(
                -45deg,
                #C8102E,
                #C8102E 10px,
                #0078D2 10px,
                #0078D2 20px
            );
            opacity: 0.6;
        }
        
        .aa-mode .logo-text {
            color: white;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        
        .aa-mode .logo-icon {
            color: white;
        }
        
        .aa-mode .toggle-label {
            color: rgba(255, 255, 255, 0.9);
        }
        
        .aa-mode .mini-card {
            background-image: linear-gradient(to bottom right, rgba(0, 120, 210, 0.05) 0%, rgba(0, 120, 210, 0) 100%);
            border-left: 3px solid #0078D2;
        }
        
        .aa-mode .card {
            background-image: linear-gradient(to bottom right, rgba(0, 120, 210, 0.05) 0%, rgba(0, 120, 210, 0) 100%);
        }
        
        .aa-mode .card-header {
            border-bottom: 2px solid #C8102E;
        }
        
        .aa-mode .mini-title i,
        .aa-mode .card-title i {
            color: #C8102E;
        }
        
        .aa-mode button[type="submit"] {
            background-color: #0078D2;
            background-image: linear-gradient(to bottom, #0078D2, #0057A5);
        }
        
        .aa-mode button[type="submit"]:hover {
            background-color: #00509B;
            background-image: linear-gradient(to bottom, #0057A5, #00509B);
        }
        
        .aa-mode .link-item {
            background-color: rgba(0, 120, 210, 0.08);
            border: 1px solid rgba(0, 120, 210, 0.2);
            transition: all 0.3s ease;
        }
        
        .aa-mode .link-item:hover {
            background-color: #0078D2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 120, 210, 0.2);
        }
        
        /* Aviation-themed elements */
        .aa-mode .time-display {
            background-image: 
                url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100' fill-opacity='0.05'%3E%3Cpath fill='%230078D2' d='M50 0 L100 100 L0 100 Z'/%3E%3C/svg%3E"),
                linear-gradient(to bottom right, #ffffff, #f7faff);
            background-size: 40px, cover;
            border: 1px solid #D1DCE8;
            border-bottom: 3px solid #0078D2;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 120, 210, 0.1);
        }
        
        /* Airport runway-inspired time display */
        .aa-mode .time-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 4px,
                rgba(0, 120, 210, 0.1) 4px,
                rgba(0, 120, 210, 0.1) 8px
            );
            z-index: 0;
            opacity: 0.5;
        }
        
        .aa-mode .time-block {
            position: relative;
            z-index: 1;
        }
        
        .aa-mode .time-label {
            color: #0078D2;
            font-weight: 700;
        }
        
        /* Aviation themed cards */
        .aa-mode .mini-card {
            position: relative;
            overflow: hidden;
        }
        
        .aa-mode .mini-card::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 40px;
            height: 40px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230078D2' opacity='0.04'%3E%3Cpath d='M12,2.5L2,22l10-7l10,7L12,2.5z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
        }
        
        /* Animated runway lights for flight tracker */
        .aa-mode #flight-tracker-card {
            position: relative;
            overflow: hidden;
        }
        
        .aa-mode #flight-tracker-card::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right,
                #C8102E 0%, #C8102E 10%,
                transparent 10%, transparent 20%,
                #C8102E 20%, #C8102E 30%,
                transparent 30%, transparent 40%,
                #C8102E 40%, #C8102E 50%,
                transparent 50%, transparent 60%,
                #C8102E 60%, #C8102E 70%,
                transparent 70%, transparent 80%,
                #C8102E 80%, #C8102E 90%,
                transparent 90%, transparent 100%
            );
            animation: runway-lights 4s infinite linear;
        }
        
        @keyframes runway-lights {
            0% { opacity: 0.2; }
            50% { opacity: 1; }
            100% { opacity: 0.2; }
        }
        
        /* Animated planes */
        @keyframes plane-fly-1 {
            0% { transform: translateX(-50px) translateY(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(150vw) translateY(-20px); opacity: 0; }
        }
        
        @keyframes plane-fly-2 {
            0% { transform: translateX(-50px) translateY(50px); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateX(120vw) translateY(0); opacity: 0; }
        }
        
        @keyframes plane-fly-3 {
            0% { transform: translateX(100vw) translateY(100px); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateX(-50px) translateY(150px); opacity: 0; }
        }
        
        .aa-mode::before,
        .aa-mode::after {
            content: '';
            position: fixed;
            width: 30px;
            height: 30px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%230078D2' opacity='0.3'%3E%3Cpath d='M21,16V14L13,9V3.5A1.5,1.5,0,0,0,11.5,2h0A1.5,1.5,0,0,0,10,3.5V9L2,14v2l8-2.5V19l-2,1.5V22l3.5-1h1L13,22V20.5l-2-1.5V13.5Z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            z-index: -1;
            pointer-events: none;
        }
        
        .aa-mode::before {
            top: 20%;
            left: 0;
            animation: plane-fly-1 25s linear infinite;
        }
        
        .aa-mode::after {
            top: 40%;
            left: 0;
            animation: plane-fly-2 40s linear infinite;
            animation-delay: 10s;
        }
        
        /* Add a third plane flying in opposite direction */
        .aa-mode .container::before {
            content: '';
            position: fixed;
            top: 70%;
            right: 0;
            width: 25px;
            height: 25px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23C8102E' opacity='0.15'%3E%3Cpath d='M21,16V14L13,9V3.5A1.5,1.5,0,0,0,11.5,2h0A1.5,1.5,0,0,0,10,3.5V9L2,14v2l8-2.5V19l-2,1.5V22l3.5-1h1L13,22V20.5l-2-1.5V13.5Z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            transform: scaleX(-1);
            animation: plane-fly-3 35s linear infinite;
            z-index: -1;
            pointer-events: none;
        }

        /* Time Display */
        .time-display {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }

        .time-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .time-block.utc {
            align-items: flex-end;
        }

        .time-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .time-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .time-date {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Cards */
        .mini-card, .card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
            transition: var(--transition);
            overflow: hidden;
        }

        .mini-card {
            padding: 16px;
            margin-bottom: 16px;
        }

        .mini-card:hover, .card:hover {
            box-shadow: var(--box-shadow-hover);
            transform: translateY(-2px);
        }

        .card {
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-actions {
            display: flex;
            gap: 8px;
        }
        
        .refresh-btn {
            color: var(--primary-color);
        }
        
        /* Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .dashboard-card {
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: var(--transition);
        }
        
        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }
        
        .dashboard-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            line-height: 1;
            margin-bottom: 8px;
            display: flex;
            align-items: baseline;
        }
        
        .dashboard-unit {
            font-size: 1rem;
            font-weight: 500;
            margin-left: 2px;
        }
        
        .dashboard-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .dashboard-trend {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .dashboard-trend.up {
            color: var(--success-color);
        }
        
        .dashboard-trend.down {
            color: var(--accent-color);
        }
        
        .dashboard-trend.warning {
            color: var(--warning-color);
        }

        .mini-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mini-title i {
            color: var(--accent-color);
        }

        .card-title {
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            font-weight: 600;
            gap: 10px;
            margin: 0;
        }

        .card-title i {
            color: var(--accent-color);
        }

        /* Forms */
        .compact-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-group {
            display: flex;
            flex: 1;
            position: relative;
        }

        .airline-select {
            width: 70px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
            text-align: center;
            font-weight: 600;
        }

        .input-group input {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            flex: 1;
        }

        .search-row {
            display: flex;
            align-items: center;
            margin-top: 8px;
        }

        .adv-search-link {
            font-size: 0.85rem;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            margin-left: auto;
            transition: var(--transition);
            gap: 5px;
        }

        .adv-search-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* Form Elements */
        input, select, button {
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            transition: var(--transition);
            background-color: var(--card-color);
            color: var(--text-color);
        }

        input::placeholder {
            color: var(--text-light);
        }

        .compact-input {
            width: 100%;
            min-width: 0;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.2);
        }

        .dark-mode input:focus, .dark-mode select:focus {
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.4);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            min-width: 55px;
            gap: 6px;
        }

        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        /* Quick Links */
        .quick-links {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .link-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: var(--primary-color);
            text-decoration: none;
            padding: 16px 8px;
            border-radius: var(--border-radius);
            text-align: center;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
            height: 100%;
            border: 1px solid rgba(2, 132, 199, 0.1);
            gap: 10px;
        }

        .link-item i {
            font-size: 1.5rem;
        }

        .link-item:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .link-item:active {
            transform: translateY(0);
        }

        .dark-mode .link-item {
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Offline Indicator */
        .offline-indicator {
            background-color: var(--warning-color);
            color: white;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            font-size: 0.9rem;
            display: none;
            align-items: center;
            justify-content: center;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        .offline .offline-indicator {
            display: flex;
        }

        /* Flight Status Display */
        .flight-status {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }

        .flight-status.show {
            display: block;
        }

        .flight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .flight-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .flight-number {
            font-weight: 700;
            color: var(--accent-color);
        }

        .flight-data {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .flight-info {
            padding: 10px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
        }

        .flight-info-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .flight-info-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .flight-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Airport Info Display */
        .airport-info {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
            animation: fadeIn 0.3s ease;
        }

        .airport-info.show {
            display: block;
        }
        
        /* Enhanced Airport Styles */
        .airport-tabs {
            display: flex;
            gap: 5px;
            margin-top: 15px;
            margin-bottom: 10px;
        }
        
        .airport-tabs.hidden {
            display: none;
        }
        
        .tab-btn {
            flex: 1;
            padding: 8px 4px;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            color: var(--text-color);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .tab-btn:hover:not(.active) {
            background-color: var(--primary-light);
        }
        
        .airport-map, .airport-gates {
            margin-top: 15px;
            padding: 12px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--border-color);
        }
        
        .airport-map.hidden, .airport-gates.hidden {
            display: none;
        }
        
        .map-container {
            width: 100%;
            aspect-ratio: 16/9;
            background-color: var(--card-color);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .map-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .gates-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .gate-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background-color: var(--card-color);
            border-radius: var(--border-radius-sm);
            border-left: 3px solid var(--primary-color);
        }
        
        .gate-terminal {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: var(--primary-color);
            font-weight: 600;
            border-radius: 50%;
        }
        
        .gate-info {
            flex: 1;
        }
        
        .gate-title {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .gate-details {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .loading-gates {
            padding: 20px 0;
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .loading-gates.hidden {
            display: none;
        }
        
        /* Aviation News Styles */
        .news-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .news-loading {
            padding: 20px 0;
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .news-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .news-items.hidden {
            display: none;
        }
        
        .news-item {
            padding: 12px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            border-left: 3px solid var(--primary-color);
            transition: var(--transition);
        }
        
        .news-item:hover {
            transform: translateX(3px);
            box-shadow: var(--box-shadow);
        }
        
        .news-date {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .news-headline {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .news-link {
            font-size: 0.8rem;
            color: var(--primary-color);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .news-link:hover {
            text-decoration: underline;
        }
        
        .news-footer {
            padding-top: 8px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        
        .news-more {
            font-size: 0.8rem;
            color: var(--primary-color);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .news-more:hover {
            text-decoration: underline;
        }
        
        .aa-mode .news-item {
            border-left-color: #0078D2;
        }
        
        .aa-mode .news-item:nth-child(2) {
            border-left-color: #C8102E;
        }
        
        /* Time Zone Calculator Styles */
        .timezone-calculator {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .tz-form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .input-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-row label {
            width: 90px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .tz-input {
            width: 100px;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--card-color);
            font-size: 0.9rem;
        }
        
        .tz-select {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--card-color);
            font-size: 0.9rem;
        }
        
        .equals-sign {
            display: flex;
            justify-content: center;
            padding: 5px 0;
            color: var(--text-light);
        }
        
        .tz-result {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }
        
        .flight-time, .arrival-day {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .flight-time-label, .arrival-day-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }
        
        .flight-time-value, .arrival-day-value {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Aviation Calculator Suite Styles */
        #calculator-card {
            margin-top: 25px;
        }
        
        .calculator-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        
        .calc-tab-btn {
            padding: 8px 15px;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .calc-tab-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .calc-tab-btn:hover:not(.active) {
            background-color: var(--primary-light);
        }
        
        .calculator-tab-content {
            padding: 15px;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-soft);
            margin-bottom: 15px;
        }
        
        .calculator-tab-content.hidden {
            display: none;
        }
        
        .calculator-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .calc-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .calc-row label {
            width: 130px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .calc-select, .calc-input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            background-color: var(--input-background);
            font-size: 0.9rem;
            color: var(--text-color);
        }
        
        .calc-button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .calc-button:hover {
            background-color: var(--primary-dark);
        }
        
        .calc-result {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            margin-top: 5px;
        }
        
        .result-label {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .result-value {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }
        
        .calc-explanation {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(var(--primary-rgb), 0.05);
            border-left: 3px solid var(--primary-color);
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .input-with-unit {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .input-unit {
            padding: 0 10px;
            background-color: var(--border-color);
            border: 1px solid var(--border-color);
            border-left: none;
            border-top-right-radius: var(--border-radius-sm);
            border-bottom-right-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            color: var(--text-light);
            height: 38px;
            display: flex;
            align-items: center;
        }
        
        .input-with-unit .calc-input {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .calc-section-header {
            font-weight: 600;
            font-size: 1rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        /* Cross Day Styling for Overtime Calculator */
        .cross-day-row {
            flex-wrap: wrap;
        }
        
        .cross-day-check {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-right: 15px;
            font-size: 0.85rem;
            min-width: 90px;
        }
        
        .cross-day-checkbox {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        /* Enhanced Search Styles */
        .search-engines {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
            padding: 8px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
        }
        
        .search-engine-option {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .search-engine-option input {
            cursor: pointer;
            width: 16px;
            height: 16px;
        }
        
        .search-engine-option label {
            cursor: pointer;
        }
        
        .search-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .search-all-btn, .adv-options-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 0.85rem;
            padding: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }
        
        .search-all-btn:hover, .adv-options-btn:hover {
            color: var(--primary-dark);
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
        }
        
        /* Collapsible Sections Styles */
        .collapsible-sections {
            margin: 20px 0;
        }
        
        .collapsible-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-soft);
            margin-bottom: 15px;
            overflow: hidden;
        }
        
        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid transparent;
            transition: var(--transition);
        }
        
        .collapsible-header:hover {
            background-color: var(--background-color);
        }
        
        .collapsible-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-btn {
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .toggle-btn:hover {
            background-color: var(--background-color);
        }
        
        .toggle-btn i {
            transition: transform 0.3s ease;
        }
        
        .toggle-btn.open i {
            transform: rotate(180deg);
        }
        
        .collapsible-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 15px;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            padding: 0 15px;
        }

        .airport-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .airport-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .airport-code {
            font-weight: 700;
            color: var(--accent-color);
        }

        .airport-data {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .airport-weather {
            grid-column: 1 / -1;
            padding: 10px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .airport-weather i {
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .airport-weather-details {
            flex: 1;
        }

        .weather-temp {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .weather-condition {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .airport-info-item {
            padding: 10px;
            background-color: var(--background-color);
            border-radius: var(--border-radius-sm);
        }

        .airport-info-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 4px;
        }

        .airport-info-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .airport-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Footer */
        .footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .update-badge {
            background-color: var(--accent-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .update-badge:hover {
            background-color: var(--accent-dark);
        }

        .hidden {
            display: none !important;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
            animation: fadeIn 0.2s ease;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-color);
            padding: 24px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 420px;
            box-shadow: var(--box-shadow-hover);
            position: relative;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        .close-modal {
            position: absolute;
            top: 16px;
            right: 20px;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--accent-color);
        }

        .modal-title {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 1.3rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .form-group input, 
        .form-group select {
            width: 100%;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            font-weight: 600;
            font-size: 1rem;
        }

        /* Small screen mode - only hides extras, doesn't change width */
        .small-screen-mode .container {
            width: 100%;
            max-width: 100%;
            padding: 5px;
        }

        /* Hide everything except essentials in small screen mode */
        .small-screen-mode .card,
        .small-screen-mode .footer,
        .small-screen-mode .time-display {
            display: none !important;
        }

        /* Adjust layout for square display */
        .small-screen-mode .header-row {
            margin-bottom: 8px;
            padding-bottom: 8px;
        }

        .small-screen-mode .logo-text {
            font-size: 1.1rem;
        }

        .small-screen-mode .mini-card {
            margin-bottom: 8px;
            padding: 10px;
        }

        .small-screen-mode .mini-title {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .small-screen-mode input, 
        .small-screen-mode select, 
        .small-screen-mode button {
            padding: 6px 8px;
            font-size: 0.8rem;
            min-width: 0;
        }

        .small-screen-mode .compact-form {
            gap: 3px;
        }
        
        .small-screen-mode .airline-select {
            width: 50px;
        }
        
        .small-screen-mode #tracking-service {
            width: 60px;
        }
        
        .small-screen-mode button {
            padding: 6px;
        }
        
        .small-screen-mode button i {
            margin-right: 0;
        }
        
        .small-screen-mode button span {
            display: none;
        }

        /* Status Bar & User Profile */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 12px 16px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-color);
            transition: var(--transition);
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success-color);
        }

        .user-status.offline .status-indicator {
            background-color: var(--text-light);
        }

        .action-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.1rem;
            cursor: pointer;
            position: relative;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .action-btn:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            font-size: 0.7rem;
            font-weight: 600;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .small-screen-mode .status-bar {
            padding: 8px 10px;
            margin-bottom: 8px;
        }

        .small-screen-mode .avatar {
            width: 32px;
            height: 32px;
            font-size: 1.2rem;
        }

        .small-screen-mode .action-menu {
            gap: 8px;
        }

        .small-screen-mode .action-btn {
            width: 30px;
            height: 30px;
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        .slide-up {
            animation: slideUp 0.3s ease;
        }

        /* Media Queries */
        @media (max-width: 480px) {
            .quick-links {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .flight-data,
            .airport-data {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: env(safe-area-inset-top, 10px) env(safe-area-inset-right, 10px) env(safe-area-inset-bottom, 10px) env(safe-area-inset-left, 10px);
            }
            
            .container {
                padding: 5px;
            }
            
            .header-row {
                margin-bottom: 12px;
                padding-bottom: 12px;
            }
            
            .toggle-container {
                gap: 8px;
            }
            
            .toggle-label {
                font-size: 0.7rem;
            }
        }

        /* Panels (Notifications, Settings) */
        .panel {
            position: fixed;
            top: 0;
            right: -380px;
            width: 360px;
            height: 100vh;
            background-color: var(--card-color);
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1200;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel.show {
            right: 0;
        }
        
        .panel-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }
        
        .close-panel {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-light);
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .close-panel:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .panel-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
        }
        
        /* Notification Items */
        .notification-item {
            display: flex;
            padding: 12px;
            border-radius: var(--border-radius-sm);
            background-color: var(--background-color);
            margin-bottom: 12px;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }
        
        .notification-item.unread {
            border-left-color: var(--primary-color);
        }
        
        .notification-item:hover {
            transform: translateX(3px);
        }
        
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .notification-icon.weather {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }
        
        .notification-icon.system {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--success-color);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }
        
        .notification-desc {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .notification-time {
            font-size: 0.75rem;
            color: var(--text-light);
        }
        
        /* Settings Items */
        .settings-section {
            margin-bottom: 24px;
        }
        
        .settings-section h4 {
            font-size: 1.05rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary-color);
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .settings-label {
            margin-left: 12px;
            font-size: 0.95rem;
        }
        
        .text-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 0.9rem;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
        }
        
        .text-btn:hover {
            background-color: var(--primary-light);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 10px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        /* Notification Toast */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 1000;
            max-width: 85%;
            text-align: center;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--error-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
        }

        .notification.info {
            background-color: var(--primary-color);
        }

        /* Icon Loading Spinner */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 16px 0;
            color: var(--primary-color);
            flex-direction: column;
            gap: 10px;
        }

        .loading i {
            animation: spin 1s linear infinite;
            font-size: 2rem;
        }

        .loading-text {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* PWA Install Button */
        .install-button {
            background-color: var(--accent-color);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            margin: 0 auto 16px;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            font-weight: 600;
            box-shadow: var(--box-shadow);
            width: 100%;
            transition: var(--transition);
            gap: 8px;
        }

        .install-button:hover {
            background-color: var(--accent-dark);
            transform: translateY(-2px);
        }

        .install-button:active {
            transform: translateY(0);
        }

        /* No results state */
        .no-results {
            text-align: center;
            padding: 20px;
            color: var(--text-light);
            font-size: 0.95rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .no-results i {
            font-size: 2rem;
            color: var(--primary-color);
            opacity: 0.7;
        }

        /* Enhanced loading animations */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Context menu for custom links */
        .context-menu {
            position: fixed;
            background-color: var(--card-color);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--box-shadow-hover);
            padding: 8px 0;
            z-index: 1001;
            min-width: 150px;
            display: none;
            animation: fadeIn 0.2s ease;
        }

        .context-menu.show {
            display: block;
        }

        .context-menu-item {
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }

        .context-menu-item i {
            width: 16px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Toggles -->
        <div class="header-row">
            <div class="logo-container">
                <i class="fas fa-paper-plane logo-icon"></i>
                <div class="logo-text">Airline Staff Portal</div>
            </div>
            <div class="toggle-container">
                <div class="toggle-group">
                    <label class="toggle-switch" title="Small Screen Mode">
                        <input type="checkbox" id="small-screen-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">Compact</span>
                </div>

                <div class="toggle-group">
                    <div class="theme-selector">
                        <button id="light-theme-btn" class="theme-btn light-theme active" title="Light Theme">
                            <i class="fas fa-sun"></i>
                        </button>
                        <button id="dark-theme-btn" class="theme-btn dark-theme" title="Dark Theme">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button id="aa-theme-btn" class="theme-btn aa-theme" title="American Airlines Theme">
                            <i class="fas fa-flag-usa"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Install PWA Button -->
        <button id="install-pwa" class="install-button">
            <i class="fas fa-download"></i> Install Airline Staff Portal
        </button>

        <!-- Time Display -->
        <div class="time-display">
            <div class="time-block local">
                <div class="time-label">LOCAL TIME</div>
                <div class="time-value" id="local-time"></div>
                <div class="time-date" id="local-date"></div>
            </div>
            <div class="time-block utc">
                <div class="time-label">UTC</div>
                <div class="time-value" id="utc-time"></div>
                <div class="time-date" id="utc-date"></div>
            </div>
        </div>

        <!-- Offline Mode Indicator -->
        <div id="offline-indicator" class="offline-indicator">
            <i class="fas fa-wifi-slash"></i> Offline Mode - Limited functionality available
        </div>

        <!-- Condensed Flight Tracker -->
        <div class="mini-card" id="flight-tracker-card">
            <div class="mini-title"><i class="fas fa-plane-departure"></i>Track Flight</div>
            <form id="flight-tracker-form" class="compact-form">
                <div class="input-group">
                    <select id="airline-select" class="airline-select" aria-label="Select Airline">
                        <option value="AAL">AA</option>
                        <option value="DAL">DL</option>
                        <option value="UAL">UA</option>
                        <option value="SWA">WN</option>
                        <option value="JBU">B6</option>
                        <option value="ASA">AS</option>
                        <option value="FFT">F9</option>
                        <option value="NKS">NK</option>
                    </select>
                    <input type="number" id="flight-number" class="compact-input" placeholder="Flight #" pattern="[0-9]*" inputmode="numeric" aria-label="Flight Number">
                </div>
                <select id="tracking-service" aria-label="Tracking Service">
                    <option value="flightaware">FlightAware</option>
                    <option value="flightradar24">FlightRadar24</option>
                    <option value="flightview">FlightView</option>
                </select>
                <button type="submit" aria-label="Track Flight"><i class="fas fa-search"></i><span>Track</span></button>
            </form>

            <!-- Flight Status Container -->
            <div id="flight-status" class="flight-status">
                <!-- Flight Status content will be inserted here dynamically -->
            </div>
        </div>

        <!-- Enhanced Airport Lookup -->
        <div class="mini-card" id="airport-info-card">
            <div class="mini-title"><i class="fas fa-info-circle"></i>Airport Info</div>
            <form id="airport-info-form" class="compact-form">
                <input type="text" id="airport-code" class="compact-input" placeholder="Airport Code (e.g. DFW)" maxlength="3" aria-label="Airport Code" pattern="[A-Za-z]{3}" title="Please enter a valid 3-letter airport code">
                <button type="submit" aria-label="Get Airport Info"><i class="fas fa-plane-arrival"></i><span>Search</span></button>
            </form>
            
            <!-- Airport Tabs -->
            <div id="airport-tabs" class="airport-tabs hidden">
                <button class="tab-btn active" data-tab="info">Info</button>
                <button class="tab-btn" data-tab="map">Terminal Map</button>
                <button class="tab-btn" data-tab="gates">Gates/Terminals</button>
            </div>

            <!-- Airport Info Container -->
            <div id="airport-info" class="airport-info">
                <!-- Airport Info content will be inserted here dynamically -->
            </div>
            
            <!-- Airport Terminal Map -->
            <div id="airport-map" class="airport-map hidden">
                <div class="map-container">
                    <!-- Terminal maps will be loaded here dynamically -->
                </div>
            </div>
            
            <!-- Airport Gates & Terminals -->
            <div id="airport-gates" class="airport-gates hidden">
                <div class="loading-gates hidden">
                    <i class="fas fa-spinner fa-pulse"></i> Loading gate information...
                </div>
                <div class="gates-list">
                    <!-- Gate information will be loaded here dynamically -->
                </div>
            </div>
        </div>




        
        <!-- Enhanced Search Options -->
        <div class="mini-card">
            <div class="mini-title"><i class="fas fa-search"></i>Multi-Engine Search</div>
            <form id="multi-search-form">
                <div class="compact-form">
                    <input type="text" name="q" placeholder="Search query..." id="search-box" class="compact-input" autocomplete="off" aria-label="Search Query">
                    <button type="submit" aria-label="Search"><i class="fas fa-arrow-right"></i><span>Search</span></button>
                </div>
                <div class="search-engines">
                    <div class="search-engine-option">
                        <input type="checkbox" id="engine-google" name="search-engines" value="google" checked>
                        <label for="engine-google">Google</label>
                    </div>
                    <div class="search-engine-option">
                        <input type="checkbox" id="engine-bing" name="search-engines" value="bing">
                        <label for="engine-bing">Bing</label>
                    </div>
                    <div class="search-engine-option">
                        <input type="checkbox" id="engine-duckduckgo" name="search-engines" value="duckduckgo">
                        <label for="engine-duckduckgo">DuckDuckGo</label>
                    </div>
                    <div class="search-engine-option">
                        <input type="checkbox" id="engine-aviation" name="search-engines" value="aviation">
                        <label for="engine-aviation">Aviation</label>
                    </div>
                </div>
                <div class="search-actions">
                    <div class="search-row">
                        <button type="button" id="open-all-engines" class="search-all-btn">
                            <i class="fas fa-external-link-alt"></i>Open All Selected
                        </button>
                    </div>
                    <div class="search-row">
                        <button type="button" id="open-adv-options" class="adv-options-btn">
                            <i class="fas fa-cog"></i>Advanced Options
                        </button>
                    </div>
                </div>
            </form>
        </div>
        


        <!-- Quick Links -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-link"></i>Quick Links</h2>
            </div>
            <div class="quick-links" id="quick-links-container">
                <a href="https://webmail.aa.com" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-envelope"></i>
                    <span>AA Email</span>
                </a>
                <a href="https://teams.microsoft.com/v2/" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-users"></i>
                    <span>Teams</span>
                </a>
                <a href="https://spteam.aa.com/sites/D5B" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-building"></i>
                    <span>ABR DFW</span>
                </a>
                <a href="https://airportal.aa.com/AirPortalWeb/HTML/dashboard/dashboard.html" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>AirPortal</span>
                </a>
                <a href="https://newjetnet.aa.com/" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-id-badge"></i>
                    <span>Jetnet</span>
                </a>
                <a href="https://tools.crew.aa.com/losa/" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-shield-alt"></i>
                    <span>LOSA</span>
                </a>
                <a href="https://flightaware.com/live/fleet/AAL" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-plane"></i>
                    <span>Fleet</span>
                </a>
                <a href="https://www.faa.gov/air_traffic/weather/asos" class="link-item" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-cloud-sun"></i>
                    <span>Weather</span>
                </a>
                <a href="#" class="link-item" id="add-link-btn">
                    <i class="fas fa-plus"></i>
                    <span>Add Link</span>
                </a>
            </div>
        </div>

        <!-- Collapsible Sections at Bottom -->
        <div class="collapsible-sections">
            <!-- Collapsible Aviation Calculator Suite -->
            <div class="collapsible-card" id="collapsible-calculator">
                <div class="collapsible-header">
                    <div class="collapsible-title"><i class="fas fa-calculator"></i>Aviation Calculator Suite</div>
                    <button class="toggle-btn" aria-label="Toggle Calculator" data-target="calculator-content">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapsible-content collapsed" id="calculator-content">
                    <div class="calculator-tabs">
                        <button class="calc-tab-btn active" data-tab="distance">Distance</button>
                        <button class="calc-tab-btn" data-tab="fuel">Fuel</button>
                        <button class="calc-tab-btn" data-tab="time">Flight Time</button>
                        <button class="calc-tab-btn" data-tab="weather">Crosswind</button>
                        <button class="calc-tab-btn" data-tab="military">Military Time</button>
                        <button class="calc-tab-btn" data-tab="overtime">Overtime</button>
                    </div>
                    
                    <!-- Distance Calculator -->
                    <div class="calculator-tab-content" id="distance-calculator">
                        <div class="calculator-form">
                            <div class="calc-row">
                                <label for="origin-airport-dist">Origin:</label>
                                <select id="origin-airport-dist" class="calc-select">
                                    <option value="DFW">DFW - Dallas/Fort Worth</option>
                                    <option value="JFK">JFK - New York Kennedy</option>
                                    <option value="LAX">LAX - Los Angeles</option>
                                    <option value="ORD">ORD - Chicago O'Hare</option>
                                    <option value="MIA">MIA - Miami</option>
                                    <option value="LHR">LHR - London Heathrow</option>
                                    <option value="CDG">CDG - Paris Charles de Gaulle</option>
                                </select>
                            </div>
                            <div class="calc-row">
                                <label for="dest-airport-dist">Destination:</label>
                                <select id="dest-airport-dist" class="calc-select">
                                    <option value="DFW">DFW - Dallas/Fort Worth</option>
                                    <option value="JFK">JFK - New York Kennedy</option>
                                    <option value="LAX" selected>LAX - Los Angeles</option>
                                    <option value="ORD">ORD - Chicago O'Hare</option>
                                    <option value="MIA">MIA - Miami</option>
                                    <option value="LHR">LHR - London Heathrow</option>
                                    <option value="CDG">CDG - Paris Charles de Gaulle</option>
                                </select>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Great Circle Distance:</div>
                                <div class="result-value" id="distance-result">1,235 NM (1,421 miles)</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Approximate Flight Time:</div>
                                <div class="result-value" id="distance-time">3h 10m</div>
                            </div>
                        </div>
                        <div class="calc-explanation">
                            <i class="fas fa-info-circle"></i> Great circle distance is the shortest distance between two points on the surface of a sphere.
                        </div>
                    </div>
                    
                    <!-- Fuel Calculator -->
                    <div class="calculator-tab-content hidden" id="fuel-calculator">
                        <div class="calculator-form">
                            <div class="calc-row">
                                <label for="aircraft-type">Aircraft Type:</label>
                                <select id="aircraft-type" class="calc-select">
                                    <option value="b738">Boeing 737-800</option>
                                    <option value="a320">Airbus A320</option>
                                    <option value="b772">Boeing 777-200</option>
                                    <option value="a333">Airbus A330-300</option>
                                    <option value="b789">Boeing 787-9</option>
                                </select>
                            </div>
                            <div class="calc-row">
                                <label for="flight-distance">Distance (NM):</label>
                                <input type="number" id="flight-distance" class="calc-input" value="1000">
                            </div>
                            <div class="calc-row">
                                <label for="fuel-reserve">Reserve (%):</label>
                                <input type="number" id="fuel-reserve" class="calc-input" value="10" min="0" max="100">
                            </div>
                            <div class="calc-row">
                                <button id="calculate-fuel" class="calc-button">Calculate</button>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Est. Fuel Required:</div>
                                <div class="result-value" id="fuel-result">12,500 lbs (5,670 kg)</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Inc. Reserve:</div>
                                <div class="result-value" id="fuel-with-reserve">13,750 lbs (6,237 kg)</div>
                            </div>
                        </div>
                        <div class="calc-explanation">
                            <i class="fas fa-info-circle"></i> Fuel calculations are estimates based on typical consumption rates for selected aircraft.
                        </div>
                    </div>
                    
                    <!-- Flight Time Calculator -->
                    <div class="calculator-tab-content hidden" id="time-calculator">
                        <div class="calculator-form">
                            <div class="calc-row">
                                <label for="distance-time-calc">Distance (NM):</label>
                                <input type="number" id="distance-time-calc" class="calc-input" value="1000">
                            </div>
                            <div class="calc-row">
                                <label for="ground-speed">Ground Speed (kts):</label>
                                <input type="number" id="ground-speed" class="calc-input" value="450">
                            </div>
                            <div class="calc-row">
                                <label for="wind-component">Headwind (+) or Tailwind (-):</label>
                                <div class="input-with-unit">
                                    <input type="number" id="wind-component" class="calc-input" value="0">
                                    <span class="input-unit">kts</span>
                                </div>
                            </div>
                            <div class="calc-row">
                                <button id="calculate-time" class="calc-button">Calculate</button>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Estimated Flight Time:</div>
                                <div class="result-value" id="time-result">2h 13m</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Adjusted Ground Speed:</div>
                                <div class="result-value" id="adjusted-gs">450 kts</div>
                            </div>
                        </div>
                        <div class="calc-explanation">
                            <i class="fas fa-info-circle"></i> Flight time is calculated using distance divided by ground speed, adjusted for wind component.
                        </div>
                    </div>
                    
                    <!-- Crosswind Calculator -->
                    <div class="calculator-tab-content hidden" id="weather-calculator">
                        <div class="calculator-form">
                            <div class="calc-row">
                                <label for="wind-speed">Wind Speed:</label>
                                <div class="input-with-unit">
                                    <input type="number" id="wind-speed" class="calc-input" value="15">
                                    <span class="input-unit">kts</span>
                                </div>
                            </div>
                            <div class="calc-row">
                                <label for="wind-direction">Wind Direction:</label>
                                <div class="input-with-unit">
                                    <input type="number" id="wind-direction" class="calc-input" value="270" min="0" max="360">
                                    <span class="input-unit"></span>
                                </div>
                            </div>
                            <div class="calc-row">
                                <label for="runway-heading">Runway Heading:</label>
                                <div class="input-with-unit">
                                    <input type="number" id="runway-heading" class="calc-input" value="180" min="0" max="360">
                                    <span class="input-unit"></span>
                                </div>
                            </div>
                            <div class="calc-row">
                                <button id="calculate-crosswind" class="calc-button">Calculate</button>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Crosswind Component:</div>
                                <div class="result-value" id="crosswind-result">15.0 kts</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Headwind Component:</div>
                                <div class="result-value" id="headwind-result">0.0 kts</div>
                            </div>
                        </div>
                        <div class="calc-explanation">
                            <i class="fas fa-info-circle"></i> Crosswind is the component of wind velocity perpendicular to the runway.
                        </div>
                    </div>
                    
                    <!-- Military Time Calculator -->
                    <div class="calculator-tab-content hidden" id="military-calculator">
                        <div class="calculator-form">
                            <div class="calc-row">
                                <label for="date-input">Date:</label>
                                <input type="date" id="date-input" class="calc-input" value="">
                            </div>
                            <div class="calc-row">
                                <label for="civilian-time">Civilian Time:</label>
                                <input type="time" id="civilian-time" class="calc-input" value="13:00">
                            </div>
                            <div class="calc-row">
                                <button id="convert-time" class="calc-button">Convert</button>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Military Date-Time Group:</div>
                                <div class="result-value" id="military-time-result">161300ZMAY25</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">NATO Format:</div>
                                <div class="result-value" id="nato-time">161300ZMAY2025</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Julian Date:</div>
                                <div class="result-value" id="julian-date">2025137</div>
                            </div>
                        </div>
                        <div class="calc-explanation">
                            <i class="fas fa-info-circle"></i> Military time uses the 24-hour clock format. The date-time group format is DDHHMM(Z/LOCAL)MMMYY.
                        </div>
                    </div>
                    
                    <!-- Overtime Calculator -->
                    <div class="calculator-tab-content hidden" id="overtime-calculator">
                        <div class="calculator-form">
                            <div class="calc-section-header">Shift Information</div>
                            <div class="calc-row">
                                <label for="shift-date">Shift Start Date:</label>
                                <input type="date" id="shift-date" class="calc-input" value="">
                            </div>
                            <div class="calc-row">
                                <label for="scheduled-start">Scheduled Start:</label>
                                <input type="time" id="scheduled-start" class="calc-input" value="22:00">
                            </div>
                            <div class="calc-row cross-day-row">
                                <div class="cross-day-check">
                                    <input type="checkbox" id="scheduled-cross-day" class="cross-day-checkbox">
                                    <label for="scheduled-cross-day">Next day</label>
                                </div>
                                <label for="scheduled-end">Scheduled End:</label>
                                <input type="time" id="scheduled-end" class="calc-input" value="06:00">
                            </div>
                            <div class="calc-row">
                                <label for="actual-start">Actual Start:</label>
                                <input type="time" id="actual-start" class="calc-input" value="21:45">
                            </div>
                            <div class="calc-row cross-day-row">
                                <div class="cross-day-check">
                                    <input type="checkbox" id="actual-cross-day" class="cross-day-checkbox">
                                    <label for="actual-cross-day">Next day</label>
                                </div>
                                <label for="actual-end">Actual End:</label>
                                <input type="time" id="actual-end" class="calc-input" value="06:30">
                            </div>
                            <div class="calc-row">
                                <label for="break-duration">Break (minutes):</label>
                                <input type="number" id="break-duration" class="calc-input" value="30" min="0">
                            </div>
                            <div class="calc-row">
                                <button id="calculate-overtime" class="calc-button">Calculate</button>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Regular Hours:</div>
                                <div class="result-value" id="regular-hours">8.00</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Overtime Hours:</div>
                                <div class="result-value" id="overtime-hours">0.75</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Total Hours:</div>
                                <div class="result-value" id="total-hours">8.75</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Early Start:</div>
                                <div class="result-value" id="early-start">00:15</div>
                            </div>
                            <div class="calc-result">
                                <div class="result-label">Late Finish:</div>
                                <div class="result-value" id="late-finish">00:30</div>
                            </div>
                        </div>
                        <div class="calc-explanation">
                            <i class="fas fa-info-circle"></i> Overtime is calculated as any time worked beyond your scheduled shift hours, minus breaks. For overnight shifts, check "Next day" if the end time is on the following day.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Collapsible Aviation News -->
            <div class="collapsible-card" id="collapsible-news">
                <div class="collapsible-header">
                    <div class="collapsible-title"><i class="fas fa-newspaper"></i>Aviation News</div>
                    <button class="toggle-btn" aria-label="Toggle News" data-target="news-content">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapsible-content collapsed" id="news-content">
                    <div class="news-container">
                        <div class="news-loading">
                            <i class="fas fa-spinner fa-pulse"></i> Loading latest headlines...
                        </div>
                        <div class="news-items hidden">
                            <!-- News items will be populated dynamically -->
                            <div class="news-item">
                                <div class="news-date">May 16, 2025</div>
                                <div class="news-headline">FAA Implements New Safety Protocols for Commercial Flights</div>
                                <a href="https://www.faa.gov/news" target="_blank" class="news-link">Read more</a>
                            </div>
                            <div class="news-item">
                                <div class="news-date">May 15, 2025</div>
                                <div class="news-headline">American Airlines Expands International Routes for Summer Season</div>
                                <a href="https://news.aa.com" target="_blank" class="news-link">Read more</a>
                            </div>
                            <div class="news-item">
                                <div class="news-date">May 14, 2025</div>
                                <div class="news-headline">Aviation Industry Reports Record Low Delays in April</div>
                                <a href="https://www.iata.org/en/pressroom/" target="_blank" class="news-link">Read more</a>
                            </div>
                        </div>
                        <div class="news-footer">
                            <a href="https://www.flightglobal.com/news" target="_blank" class="news-more">View all aviation news</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Collapsible Time Zone Calculator -->
            <div class="collapsible-card" id="collapsible-timezone">
                <div class="collapsible-header">
                    <div class="collapsible-title"><i class="fas fa-clock"></i>Time Zone Calculator</div>
                    <button class="toggle-btn" aria-label="Toggle Time Zone Calculator" data-target="timezone-content">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="collapsible-content collapsed" id="timezone-content">
                    <div class="timezone-calculator">
                        <div class="tz-form">
                            <div class="input-row">
                                <label for="origin-time">Local Time:</label>
                                <input type="time" id="origin-time" class="tz-input" value="12:00">
                                <select id="origin-airport" class="tz-select">
                                    <option value="JFK">JFK (UTC-4)</option>
                                    <option value="LAX">LAX (UTC-7)</option>
                                    <option value="ORD">ORD (UTC-5)</option>
                                    <option value="DFW" selected>DFW (UTC-5)</option>
                                    <option value="MIA">MIA (UTC-4)</option>
                                    <option value="LHR">LHR (UTC+1)</option>
                                    <option value="NRT">NRT (UTC+9)</option>
                                    <option value="SYD">SYD (UTC+10)</option>
                                </select>
                            </div>
                            <div class="equals-sign">
                                <i class="fas fa-equals"></i>
                            </div>
                            <div class="input-row">
                                <label for="destination-time">Destination:</label>
                                <input type="time" id="destination-time" class="tz-input" readonly>
                                <select id="destination-airport" class="tz-select">
                                    <option value="JFK">JFK (UTC-4)</option>
                                    <option value="LAX">LAX (UTC-7)</option>
                                    <option value="ORD">ORD (UTC-5)</option>
                                    <option value="DFW">DFW (UTC-5)</option>
                                    <option value="MIA">MIA (UTC-4)</option>
                                    <option value="LHR" selected>LHR (UTC+1)</option>
                                    <option value="NRT">NRT (UTC+9)</option>
                                    <option value="SYD">SYD (UTC+10)</option>
                                </select>
                            </div>
                        </div>
                        <div class="tz-result">
                            <div class="flight-time">
                                <div class="flight-time-label">Est. Flight Time:</div>
                                <div class="flight-time-value">9h 45m</div>
                            </div>
                            <div class="arrival-day">
                                <div class="arrival-day-label">Arrival:</div>
                                <div class="arrival-day-value">Same day</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- App Status -->
        <div class="footer">
            <span>Airline Staff Portal  v2.0.0</span>
            <span id="update-available" class="update-badge hidden">Update Available</span>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>
    
    <!-- Notifications Panel -->
    <div id="notifications-panel" class="panel">
        <div class="panel-header">
            <h3>Notifications</h3>
            <button class="close-panel"><i class="fas fa-times"></i></button>
        </div>
        <div class="panel-content">
            <div class="notification-item unread">
                <div class="notification-icon"><i class="fas fa-plane-arrival"></i></div>
                <div class="notification-content">
                    <div class="notification-title">Flight AA1234 Arrived</div>
                    <div class="notification-desc">Flight AA1234 has arrived at gate B12, 10 minutes early.</div>
                    <div class="notification-time">35 min ago</div>
                </div>
            </div>
            <div class="notification-item unread">
                <div class="notification-icon weather"><i class="fas fa-cloud-bolt"></i></div>
                <div class="notification-content">
                    <div class="notification-title">Weather Alert: DFW</div>
                    <div class="notification-desc">Thunderstorms expected at DFW from 3PM to 6PM local time.</div>
                    <div class="notification-time">1 hour ago</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon system"><i class="fas fa-sync"></i></div>
                <div class="notification-content">
                    <div class="notification-title">System Update</div>
                    <div class="notification-desc">New features have been added to the crew portal.</div>
                    <div class="notification-time">Today, 9:45 AM</div>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <button class="text-btn">Mark all as read</button>
            <button class="text-btn">View all notifications</button>
        </div>
    </div>
    
    <!-- Settings Panel -->
    <div id="settings-panel" class="panel">
        <div class="panel-header">
            <h3>Settings</h3>
            <button class="close-panel"><i class="fas fa-times"></i></button>
        </div>
        <div class="panel-content">
            <div class="settings-section">
                <h4>Display</h4>
                <div class="settings-item">
                    <label class="toggle-switch" title="Dark Mode">
                        <input type="checkbox" id="settings-dark-mode">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="settings-label">Dark Mode</span>
                </div>
                <div class="settings-item">
                    <label class="toggle-switch" title="Compact Mode">
                        <input type="checkbox" id="settings-compact-mode">
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="settings-label">Compact Mode</span>
                </div>
            </div>
            <div class="settings-section">
                <h4>Notifications</h4>
                <div class="settings-item">
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="settings-label">Flight Updates</span>
                </div>
                <div class="settings-item">
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="settings-label">Weather Alerts</span>
                </div>
                <div class="settings-item">
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="settings-label">System Notifications</span>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <button class="btn-primary">Save Settings</button>
        </div>
    </div>

    <!-- Modal for adding custom links -->
    <div id="add-link-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 class="modal-title">Add Custom Link</h3>
            <form id="add-link-form">
                <div class="form-group">
                    <label for="link-name">Name:</label>
                    <input type="text" id="link-name" required maxlength="15">
                </div>
                <div class="form-group">
                    <label for="link-url">URL:</label>
                    <input type="url" id="link-url" required placeholder="https://">
                </div>
                <div class="form-group">
                    <label for="link-icon">Icon:</label>
                    <select id="link-icon">
                        <option value="fa-link">Link</option>
                        <option value="fa-plane">Plane</option>
                        <option value="fa-plane-departure">Departure</option>
                        <option value="fa-plane-arrival">Arrival</option>
                        <option value="fa-clipboard">Clipboard</option>
                        <option value="fa-calendar">Calendar</option>
                        <option value="fa-user">User</option>
                        <option value="fa-users">Users</option>
                        <option value="fa-map">Map</option>
                        <option value="fa-cog">Settings</option>
                        <option value="fa-envelope">Email</option>
                        <option value="fa-file">File</option>
                        <option value="fa-chart-line">Chart</option>
                        <option value="fa-clock">Clock</option>
                        <option value="fa-book">Book</option>
                        <option value="fa-cloud">Cloud</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Add Link</button>
            </form>
        </div>
    </div>

    <!-- Context menu for custom links -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item" id="edit-link">
            <i class="fas fa-edit"></i> Edit
        </div>
        <div class="context-menu-item" id="delete-link">
            <i class="fas fa-trash"></i> Delete
        </div>
    </div>

    <!-- Modal for editing custom links -->
    <div id="edit-link-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 class="modal-title">Edit Custom Link</h3>
            <form id="edit-link-form">
                <input type="hidden" id="edit-link-id">
                <div class="form-group">
                    <label for="edit-link-name">Name:</label>
                    <input type="text" id="edit-link-name" required maxlength="15">
                </div>
                <div class="form-group">
                    <label for="edit-link-url">URL:</label>
                    <input type="url" id="edit-link-url" required placeholder="https://">
                </div>
                <div class="form-group">
                    <label for="edit-link-icon">Icon:</label>
                    <select id="edit-link-icon">
                        <option value="fa-link">Link</option>
                        <option value="fa-plane">Plane</option>
                        <option value="fa-plane-departure">Departure</option>
                        <option value="fa-plane-arrival">Arrival</option>
                        <option value="fa-clipboard">Clipboard</option>
                        <option value="fa-calendar">Calendar</option>
                        <option value="fa-user">User</option>
                        <option value="fa-users">Users</option>
                        <option value="fa-map">Map</option>
                        <option value="fa-cog">Settings</option>
                        <option value="fa-envelope">Email</option>
                        <option value="fa-file">File</option>
                        <option value="fa-chart-line">Chart</option>
                        <option value="fa-clock">Clock</option>
                        <option value="fa-book">Book</option>
                        <option value="fa-cloud">Cloud</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Inline JavaScript -->
    <script>
        // Constants
        const APP_VERSION = '2.0.0';
        const CACHE_VERSION = 'airline-staff-portal-v2.0.0';
        const CUSTOM_LINKS_KEY = 'airline-staff-portal-custom-links';
        const DARK_MODE_KEY = 'airline-staff-portal-dark-mode';
        const SMALL_SCREEN_KEY = 'airline-staff-portal-small-screen';

        // Create the manifest
        const manifestData = {
            name: "Airline Staff Portal",
            short_name: "AA Staff",
            description: "Essential tools for airline staff - flight tracking, airport info, and quick links",
            id: "/index.html",
            start_url: "./index.html",
            display: "standalone",
            background_color: "#0063c6",
            theme_color: "#0063c6",
            orientation: "portrait-primary",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSIjMDA2M2M2IiBkPSJNNTAsMTBMOTAsOTBIMTBMNTAsMTB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCw3NWwtMjUtMTBoNTBMNTAsNzV6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCwyNWwxNSw0NUg2NWwtMTUtNDV6Ii8+PC9zdmc+",
                    sizes: "192x192",
                    type: "image/svg+xml",
                    purpose: "any"
                },
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9IjEwMCIgZmlsbD0iIzAwNjNjNiIvPjxwYXRoIGZpbGw9IndoaXRlIiBkPSJNMjU2LDEwMEwzOTAsMzgwSDEyMkwyNTYsMTAweiIvPjxwYXRoIGZpbGw9IiNlNDAwNDYiIGQ9Ik0yNTYsMzIwbC0zNS0xOGg3MEwyNTYsMzIweiIvPjxwYXRoIGZpbGw9IiNlNDAwNDYiIGQ9Ik0yNTYsMTUwbDIwLDcwaDIwbC0yMC03MHoiLz48L3N2Zz4=",
                    sizes: "512x512",
                    type: "image/svg+xml",
                    purpose: "any maskable"
                }
            ],
            shortcuts: [
                {
                    name: "Track Flight",
                    short_name: "Flight",
                    description: "Track a flight quickly",
                    url: "./index.html?action=track_flight",
                    icons: [{ 
                        src: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0NSIgZmlsbD0iIzAwNjNjNiIvPjxwYXRoIGZpbGw9IndoaXRlIiBkPSJNNzAsMzBMNDAsNjVIMzBMNjAsMzBINzB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik03MCw1MEw1MCw2NUg0MEw2MCw1MEg3MHoiLz48L3N2Zz4=", 
                        sizes: "192x192" 
                    }]
                },
                {
                    name: "Airport Info",
                    short_name: "Airport",
                    description: "Look up airport information",
                    url: "./index.html?action=airport_info",
                    icons: [{ 
                        src: "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0NSIgZmlsbD0iIzAwNjNjNiIvPjxwYXRoIGZpbGw9IndoaXRlIiBkPSJNNTAsNzBMMzAsNTVINzBMNTAsNzB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCwzMEw2NSw1MEg2MEw0NSwzMEg1MHoiLz48L3N2Zz4=", 
                        sizes: "192x192" 
                    }]
                }
            ],
            scope: "./",
            related_applications: [],
            prefer_related_applications: false,
            categories: ["utilities", "productivity"]
        };

        // Create Blob and Object URL for manifest
        const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestURL;

        // DOM elements
        const localTimeElement = document.getElementById('local-time');
        const localDateElement = document.getElementById('local-date');
        const utcTimeElement = document.getElementById('utc-time');
        const utcDateElement = document.getElementById('utc-date');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const smallScreenToggle = document.getElementById('small-screen-toggle');
        const flightTrackerForm = document.getElementById('flight-tracker-form');
        const flightStatusContainer = document.getElementById('flight-status');
        const multiSearchForm = document.getElementById('multi-search-form');
        const airportInfoForm = document.getElementById('airport-info-form');
        const airportInfoContainer = document.getElementById('airport-info');
        const addLinkBtn = document.getElementById('add-link-btn');
        const addLinkModal = document.getElementById('add-link-modal');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const addLinkForm = document.getElementById('add-link-form');
        const editLinkForm = document.getElementById('edit-link-form');
        const editLinkModal = document.getElementById('edit-link-modal');
        const notificationElement = document.getElementById('notification');
        const installButton = document.getElementById('install-pwa');
        const contextMenu = document.getElementById('context-menu');
        const editLinkBtn = document.getElementById('edit-link');
        const deleteLinkBtn = document.getElementById('delete-link');

        // PWA install event
        let deferredPrompt;
        let currentCustomLinkElement = null;

        // Setup panels (notifications, settings, etc.)
        function setupPanels() {
            const panelButtons = document.querySelectorAll('.panel-btn');
            const closePanelButtons = document.querySelectorAll('.close-panel');
            
            // Panel toggle buttons
            panelButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const panelId = this.getAttribute('data-panel');
                    const panel = document.getElementById(panelId);
                    
                    if (panel) {
                        // Close any open panels first
                        document.querySelectorAll('.panel').forEach(p => {
                            if (p.id !== panelId) {
                                p.classList.remove('open');
                            }
                        });
                        
                        // Toggle the target panel
                        panel.classList.toggle('open');
                    }
                });
            });
            
            // Close panel buttons
            closePanelButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const panel = this.closest('.panel');
                    if (panel) {
                        panel.classList.remove('open');
                    }
                });
            });
        }
        
        // Aviation Calculator Suite Functions
        function initCalculatorSuite() {
            // Distance Calculator
            const originAirportDist = document.getElementById('origin-airport-dist');
            const destAirportDist = document.getElementById('dest-airport-dist');
            const distanceResult = document.getElementById('distance-result');
            const distanceTime = document.getElementById('distance-time');
            
            if (!originAirportDist || !destAirportDist) return; // Bail if elements not found
            
            // Airport coordinates (latitude, longitude)
            const airportCoordinates = {
                'DFW': { lat: 32.8998, lon: -97.0403 },
                'JFK': { lat: 40.6413, lon: -73.7781 },
                'LAX': { lat: 33.9416, lon: -118.4085 },
                'ORD': { lat: 41.9742, lon: -87.9073 },
                'MIA': { lat: 25.7932, lon: -80.2906 },
                'LHR': { lat: 51.4700, lon: -0.4543 },
                'CDG': { lat: 49.0097, lon: 2.5479 }
            };
            
            // Calculate distance between two points using Haversine formula
            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 3440.065; // Radius of the earth in nautical miles
                const dLat = deg2rad(lat2 - lat1);
                const dLon = deg2rad(lon2 - lon1);
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distance = R * c; // Distance in nautical miles
                return distance;
            }
            
            function deg2rad(deg) {
                return deg * (Math.PI/180);
            }
            
            function updateDistanceCalculation() {
                const origin = originAirportDist.value;
                const dest = destAirportDist.value;
                
                if (origin && dest && airportCoordinates[origin] && airportCoordinates[dest]) {
                    const distance = calculateDistance(
                        airportCoordinates[origin].lat, airportCoordinates[origin].lon,
                        airportCoordinates[dest].lat, airportCoordinates[dest].lon
                    );
                    
                    // Round to nearest whole number
                    const nmDistance = Math.round(distance);
                    const milesDistance = Math.round(distance * 1.15078);
                    
                    // Update the result
                    distanceResult.textContent = `${nmDistance.toLocaleString()} NM (${milesDistance.toLocaleString()} miles)`;
                    
                    // Estimate flight time (assuming 450 kts ground speed)
                    const flightHours = Math.floor(distance / 450);
                    const flightMinutes = Math.round((distance / 450 - flightHours) * 60);
                    distanceTime.textContent = `${flightHours}h ${flightMinutes}m`;
                }
            }
            
            // Add event listeners for distance calculator
            originAirportDist.addEventListener('change', updateDistanceCalculation);
            destAirportDist.addEventListener('change', updateDistanceCalculation);
            
            // Initialize with default values
            updateDistanceCalculation();
            
            // Fuel Calculator
            const aircraftType = document.getElementById('aircraft-type');
            const flightDistance = document.getElementById('flight-distance');
            const fuelReserve = document.getElementById('fuel-reserve');
            const calculateFuelBtn = document.getElementById('calculate-fuel');
            const fuelResult = document.getElementById('fuel-result');
            const fuelWithReserve = document.getElementById('fuel-with-reserve');
            
            if (calculateFuelBtn) {
                // Aircraft fuel consumption rates (lbs per nm)
                const aircraftFuelRates = {
                    'b738': 12.5, // Boeing 737-800
                    'a320': 11.8, // Airbus A320
                    'b772': 24.2, // Boeing 777-200
                    'a333': 22.5, // Airbus A330-300
                    'b789': 20.3  // Boeing 787-9
                };
                
                function calculateFuel() {
                    const aircraft = aircraftType.value;
                    const distance = parseFloat(flightDistance.value);
                    const reserve = parseFloat(fuelReserve.value) / 100; // Convert to decimal
                    
                    if (aircraft && !isNaN(distance) && !isNaN(reserve) && aircraftFuelRates[aircraft]) {
                        // Calculate fuel required
                        const fuelRate = aircraftFuelRates[aircraft];
                        const fuelRequired = distance * fuelRate;
                        const fuelWithReserveAmount = fuelRequired * (1 + reserve);
                        
                        // Convert to kg (1 lb = 0.453592 kg)
                        const fuelRequiredKg = fuelRequired * 0.453592;
                        const fuelWithReserveKg = fuelWithReserveAmount * 0.453592;
                        
                        // Update the results
                        fuelResult.textContent = `${Math.round(fuelRequired).toLocaleString()} lbs (${Math.round(fuelRequiredKg).toLocaleString()} kg)`;
                        fuelWithReserve.textContent = `${Math.round(fuelWithReserveAmount).toLocaleString()} lbs (${Math.round(fuelWithReserveKg).toLocaleString()} kg)`;
                    }
                }
                
                // Add event listener for fuel calculator
                calculateFuelBtn.addEventListener('click', calculateFuel);
                
                // Initialize with default values
                calculateFuel();
            }
            
            // Flight Time Calculator
            const distanceTimeCalc = document.getElementById('distance-time-calc');
            const groundSpeed = document.getElementById('ground-speed');
            const windComponent = document.getElementById('wind-component');
            const calculateTimeBtn = document.getElementById('calculate-time');
            const timeResult = document.getElementById('time-result');
            const adjustedGS = document.getElementById('adjusted-gs');
            
            if (calculateTimeBtn) {
                function calculateFlightTime() {
                    const distance = parseFloat(distanceTimeCalc.value);
                    const gs = parseFloat(groundSpeed.value);
                    const wind = parseFloat(windComponent.value);
                    
                    if (!isNaN(distance) && !isNaN(gs) && !isNaN(wind)) {
                        // Calculate adjusted ground speed with wind
                        const adjustedGroundSpeed = gs - wind;
                        
                        // Calculate flight time in hours
                        const flightHours = distance / adjustedGroundSpeed;
                        
                        // Convert to hours and minutes
                        const hours = Math.floor(flightHours);
                        const minutes = Math.round((flightHours - hours) * 60);
                        
                        // Update the results
                        timeResult.textContent = `${hours}h ${minutes}m`;
                        adjustedGS.textContent = `${adjustedGroundSpeed} kts`;
                    }
                }
                
                // Add event listener for time calculator
                calculateTimeBtn.addEventListener('click', calculateFlightTime);
                
                // Initialize with default values
                calculateFlightTime();
            }
            
            // Crosswind Calculator
            const windSpeed = document.getElementById('wind-speed');
            const windDirection = document.getElementById('wind-direction');
            const runwayHeading = document.getElementById('runway-heading');
            const calculateCrosswindBtn = document.getElementById('calculate-crosswind');
            const crosswindResult = document.getElementById('crosswind-result');
            const headwindResult = document.getElementById('headwind-result');
            
            if (calculateCrosswindBtn) {
                function calculateCrosswind() {
                    const speed = parseFloat(windSpeed.value);
                    const direction = parseFloat(windDirection.value);
                    const runway = parseFloat(runwayHeading.value);
                    
                    if (!isNaN(speed) && !isNaN(direction) && !isNaN(runway)) {
                        // Calculate angle between wind direction and runway heading
                        const angle = Math.abs(direction - runway);
                        const radians = (angle % 180) * Math.PI / 180;
                        
                        // Calculate crosswind and headwind components
                        const crosswind = Math.abs(speed * Math.sin(radians)).toFixed(1);
                        const headwind = (speed * Math.cos(radians)).toFixed(1);
                        
                        // Update the results
                        crosswindResult.textContent = `${crosswind} kts`;
                        headwindResult.textContent = `${headwind} kts`;
                    }
                }
                
                // Add event listener for crosswind calculator
                calculateCrosswindBtn.addEventListener('click', calculateCrosswind);
                
                // Initialize with default values
                calculateCrosswind();
            }
            
            // Calculator Tabs
            const calculatorTabs = document.querySelectorAll('.calc-tab-btn');
            const calculatorContents = document.querySelectorAll('.calculator-tab-content');
            
            calculatorTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    calculatorTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show the selected content
                    calculatorContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`${tabName}-calculator`).classList.remove('hidden');
                });
            });
        }
        
        // Setup collapsible sections
        function setupCollapsibles() {
            const toggleButtons = document.querySelectorAll('.toggle-btn');
            
            toggleButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const targetContent = document.getElementById(targetId);
                    
                    if (targetContent) {
                        // Toggle the collapsed class
                        targetContent.classList.toggle('collapsed');
                        
                        // Toggle the open class on the button
                        this.classList.toggle('open');
                    }
                });
            });
            
            // Also set up the header click to toggle
            const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
            
            collapsibleHeaders.forEach(header => {
                header.addEventListener('click', function(e) {
                    // Don't trigger if the button itself was clicked
                    if (e.target.closest('.toggle-btn')) return;
                    
                    const btn = this.querySelector('.toggle-btn');
                    if (btn) btn.click();
                });
            });
        }
        
        // Initialize the Overtime Calculator
        function initOvertimeCalculator() {
            const shiftDate = document.getElementById('shift-date');
            const scheduledStart = document.getElementById('scheduled-start');
            const scheduledEnd = document.getElementById('scheduled-end');
            const scheduledCrossDay = document.getElementById('scheduled-cross-day');
            const actualStart = document.getElementById('actual-start');
            const actualEnd = document.getElementById('actual-end');
            const actualCrossDay = document.getElementById('actual-cross-day');
            const breakDuration = document.getElementById('break-duration');
            const calculateOvertimeBtn = document.getElementById('calculate-overtime');
            
            // Results elements
            const regularHours = document.getElementById('regular-hours');
            const overtimeHours = document.getElementById('overtime-hours');
            const totalHours = document.getElementById('total-hours');
            const earlyStart = document.getElementById('early-start');
            const lateFinish = document.getElementById('late-finish');
            
            if (!shiftDate || !calculateOvertimeBtn) return; // Bail if elements not found
            
            // Set the date input to today by default
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            shiftDate.value = dateString;
            
            // Helper function to convert time strings to minutes
            function timeToMinutes(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return hours * 60 + minutes;
            }
            
            // Helper function to format minutes as HH:MM
            function minutesToTime(totalMinutes) {
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            }
            
            // Function to calculate overtime
            function calculateOvertime() {
                // Get scheduled shift duration in minutes
                const schedStartMinutes = timeToMinutes(scheduledStart.value);
                let schedEndMinutes = timeToMinutes(scheduledEnd.value);
                
                // Adjust end times for cross-day shifts
                if (scheduledCrossDay.checked) {
                    schedEndMinutes += 24 * 60; // Add 24 hours if end is next day
                }
                
                // Calculate scheduled shift duration
                const scheduledDuration = schedEndMinutes - schedStartMinutes;
                
                // Get actual work duration in minutes
                const actStartMinutes = timeToMinutes(actualStart.value);
                let actEndMinutes = timeToMinutes(actualEnd.value);
                
                // Adjust actual end time for cross-day
                if (actualCrossDay.checked) {
                    actEndMinutes += 24 * 60; // Add 24 hours if end is next day
                }
                
                // Calculate actual duration
                const actualDuration = actEndMinutes - actStartMinutes;
                
                // Break duration in minutes
                const breakMinutes = parseInt(breakDuration.value) || 0;
                
                // Calculate actual worked hours (minus break)
                const actualWorkedMinutes = actualDuration - breakMinutes;
                
                // Calculate regular hours (capped at scheduled hours)
                const regularMinutes = Math.min(scheduledDuration, actualWorkedMinutes);
                
                // Calculate overtime (any time beyond scheduled hours)
                const overtimeMinutes = Math.max(0, actualWorkedMinutes - scheduledDuration);
                
                // Calculate early start and late finish
                const earlyStartMinutes = Math.max(0, schedStartMinutes - actStartMinutes);
                const lateFinishMinutes = Math.max(0, actEndMinutes - schedEndMinutes);
                
                // Update results
                regularHours.textContent = (regularMinutes / 60).toFixed(2);
                overtimeHours.textContent = (overtimeMinutes / 60).toFixed(2);
                totalHours.textContent = ((regularMinutes + overtimeMinutes) / 60).toFixed(2);
                earlyStart.textContent = minutesToTime(earlyStartMinutes);
                lateFinish.textContent = minutesToTime(lateFinishMinutes);
            }
            
            // Add event listener
            calculateOvertimeBtn.addEventListener('click', calculateOvertime);
            
            // Initialize with default values
            calculateOvertime();
        }
        
        // Initialize the Military Time Calculator
        function initMilitaryTimeCalculator() {
            const dateInput = document.getElementById('date-input');
            const civilianTime = document.getElementById('civilian-time');
            const convertTimeBtn = document.getElementById('convert-time');
            const militaryTimeResult = document.getElementById('military-time-result');
            const natoTime = document.getElementById('nato-time');
            const julianDate = document.getElementById('julian-date');
            
            if (!dateInput || !civilianTime || !convertTimeBtn) return; // Bail if elements not found
            
            // Set the date input to today by default
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            dateInput.value = dateString;
            
            // Function to convert to military time formats
            function convertToMilitaryTime() {
                // Get the input values
                const dateValue = dateInput.value ? new Date(dateInput.value) : new Date();
                const timeValue = civilianTime.value || '00:00';
                
                // Extract date components
                const day = dateValue.getDate().toString().padStart(2, '0');
                const month = dateValue.toLocaleString('en-US', { month: 'short' }).toUpperCase();
                const year = dateValue.getFullYear().toString().slice(-2);
                const fullYear = dateValue.getFullYear();
                
                // Extract time components
                const [hours, minutes] = timeValue.split(':').map(Number);
                const timeString = `${hours.toString().padStart(2, '0')}${minutes.toString().padStart(2, '0')}`;
                
                // Calculate Julian date (day of year)
                const startOfYear = new Date(dateValue.getFullYear(), 0, 0);
                const diff = dateValue - startOfYear;
                const oneDay = 1000 * 60 * 60 * 24;
                const dayOfYear = Math.floor(diff / oneDay);
                
                // Format the results
                const militaryFormat = `${day}${timeString}ZMAY${year}`;
                const natoFormat = `${day}${timeString}ZMAY${fullYear}`;
                const julianFormat = `${fullYear}${dayOfYear.toString().padStart(3, '0')}`;
                
                // Update the results
                militaryTimeResult.textContent = militaryFormat;
                natoTime.textContent = natoFormat;
                julianDate.textContent = julianFormat;
            }
            
            // Add event listener
            convertTimeBtn.addEventListener('click', convertToMilitaryTime);
            
            // Initialize with default values
            convertToMilitaryTime();
        }
        
        // Initialize the time zone calculator
        function initTimeZoneCalculator() {
            const originTimeInput = document.getElementById('origin-time');
            const originAirportSelect = document.getElementById('origin-airport');
            const destinationTimeInput = document.getElementById('destination-time');
            const destinationAirportSelect = document.getElementById('destination-airport');
            
            if (!originTimeInput || !originAirportSelect) return; // Bail if elements not found
            
            const flightTimeValue = document.querySelector('.flight-time-value');
            const arrivalDayValue = document.querySelector('.arrival-day-value');
            
            // Airport timezone mapping (UTC offsets in hours)
            const airportTimezones = {
                'JFK': -4, // New York
                'LAX': -7, // Los Angeles
                'ORD': -5, // Chicago
                'DFW': -5, // Dallas
                'MIA': -4, // Miami
                'LHR': +1, // London
                'NRT': +9, // Tokyo
                'SYD': +10 // Sydney
            };
            
            // Estimated flight times between city pairs (in minutes)
            const flightTimes = {
                'JFK-LHR': 420, // 7h
                'LHR-JFK': 480, // 8h
                'JFK-LAX': 360, // 6h
                'LAX-JFK': 300, // 5h
                'DFW-LHR': 585, // 9h 45m
                'LHR-DFW': 630, // 10h 30m
                'DFW-LAX': 195, // 3h 15m
                'LAX-DFW': 165, // 2h 45m
                'LAX-NRT': 660, // 11h
                'NRT-LAX': 600, // 10h
                'SYD-LAX': 840, // 14h
                'LAX-SYD': 900  // 15h
            };
            
            // Function to update destination time based on origin
            function updateTimes() {
                // Parse the time from the origin input
                const originTime = originTimeInput.value;
                const [hours, minutes] = originTime.split(':').map(Number);
                
                // Get the timezone offsets
                const originOffset = airportTimezones[originAirportSelect.value] || 0;
                const destOffset = airportTimezones[destinationAirportSelect.value] || 0;
                
                // Calculate the time difference in hours
                const timeDiff = destOffset - originOffset;
                
                // Calculate the destination time in UTC
                let destHours = hours + timeDiff;
                let nextDay = false;
                let prevDay = false;
                
                // Adjust for day changes
                if (destHours >= 24) {
                    destHours -= 24;
                    nextDay = true;
                } else if (destHours < 0) {
                    destHours += 24;
                    prevDay = true;
                }
                
                // Format the destination time
                const destTime = `${String(destHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                destinationTimeInput.value = destTime;
                
                // Update the arrival day info
                if (arrivalDayValue) {
                    if (nextDay) {
                        arrivalDayValue.textContent = 'Next day';
                    } else if (prevDay) {
                        arrivalDayValue.textContent = 'Previous day';
                    } else {
                        arrivalDayValue.textContent = 'Same day';
                    }
                }
                
                // Update estimated flight time
                if (flightTimeValue) {
                    const routeKey = `${originAirportSelect.value}-${destinationAirportSelect.value}`;
                    const flightTimeMinutes = flightTimes[routeKey] || 
                                            flightTimes[`${destinationAirportSelect.value}-${originAirportSelect.value}`] || 
                                            Math.abs(timeDiff) * 60 + 120; // Fallback estimate
                    
                    const flightTimeHours = Math.floor(flightTimeMinutes / 60);
                    const flightTimeRemainingMinutes = flightTimeMinutes % 60;
                    flightTimeValue.textContent = `${flightTimeHours}h ${flightTimeRemainingMinutes}m`;
                }
            }
            
            // Add event listeners
            originTimeInput.addEventListener('change', updateTimes);
            originAirportSelect.addEventListener('change', updateTimes);
            destinationAirportSelect.addEventListener('change', updateTimes);
            
            // Initialize with default values
            updateTimes();
        }
        
        // Initialize application
        function initApp() {
            // Initialize clock
            updateTime();
            setInterval(updateTime, 1000);

            // Load saved preferences
            loadSavedPreferences();

            // Load custom links
            loadCustomLinks();

            // Initialize listeners
            initEventListeners();

            // Check network status and set up listeners
            updateOnlineStatus();
            
            // Setup notifications and settings panels
            setupPanels();
            
            // Initialize aviation calculator features
            initCalculatorSuite();
            initTimeZoneCalculator();
            initMilitaryTimeCalculator();
            initOvertimeCalculator();
            setupCollapsibles();
            
            // Setup dashboard refresh button if available
            if (typeof setupDashboard === 'function') {
                setupDashboard();
            }
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);

            // Register service worker
            registerServiceWorker();

            // Process URL parameters (for shortcuts)
            processUrlParams();

            // Setup PWA installation
            setupPWAInstall();
        }

        // Setup PWA install prompt
        function setupPWAInstall() {
            // Listen for the beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                // Prevent Chrome 67 and earlier from automatically showing the prompt
                e.preventDefault();
                // Stash the event so it can be triggered later
                deferredPrompt = e;
                // Update UI to notify the user they can add to home screen
                installButton.style.display = 'flex';
            });

            // Installation button click handler
            installButton.addEventListener('click', async () => {
                if (!deferredPrompt) {
                    showNotification('Installation not available in this browser', 'info');
                    return;
                }
                // Show the install prompt
                deferredPrompt.prompt();
                
                try {
                    // Wait for the user to respond to the prompt
                    const { outcome } = await deferredPrompt.userChoice;
                    // Optionally, send analytics event with outcome of user choice
                    console.log(`User response to the install prompt: ${outcome}`);
                }
                catch(err) {
                    console.error('Install prompt error:', err);
                }
                
                // We've used the prompt, and can't use it again, throw it away
                deferredPrompt = null;
                // Hide the install button
                installButton.style.display = 'none';
            });

            // Listen for successful install
            window.addEventListener('appinstalled', (evt) => {
                // Log install to analytics
                console.log('INSTALL: Success');
                // Hide the install button
                installButton.style.display = 'none';
                // Show notification
                showNotification('App successfully installed!', 'success');
            });
        }

        // Process URL parameters
        function processUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');

            if (action === 'track_flight') {
                document.getElementById('flight-number').focus();
            } else if (action === 'airport_info') {
                document.getElementById('airport-code').focus();
            }
        }

        // Update time display
        function updateTime() {
            const now = new Date();

            // Format local time
            localTimeElement.textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });

            localDateElement.textContent = now.toLocaleDateString('en-US', { 
                weekday: 'short',
                month: 'short', 
                day: 'numeric' 
            });

            // Format UTC time
            utcTimeElement.textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'UTC' 
            });

            utcDateElement.textContent = now.toLocaleDateString('en-US', { 
                weekday: 'short',
                month: 'short', 
                day: 'numeric', 
                timeZone: 'UTC' 
            });
        }

        // Load user preferences
        // Theme switching function
        function setActiveTheme(theme) {
            // Remove all theme classes
            document.documentElement.classList.remove('dark-mode', 'aa-mode');
            
            // Remove active class from all theme buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Set the new theme
            if (theme === 'dark') {
                document.documentElement.classList.add('dark-mode');
                const darkBtn = document.getElementById('dark-theme-btn');
                if (darkBtn) darkBtn.classList.add('active');
            } else if (theme === 'aa') {
                document.documentElement.classList.add('aa-mode');
                const aaBtn = document.getElementById('aa-theme-btn');
                if (aaBtn) aaBtn.classList.add('active');
            } else {
                // Light theme (default)
                const lightBtn = document.getElementById('light-theme-btn');
                if (lightBtn) lightBtn.classList.add('active');
            }
            
            // Save theme preference
            localStorage.setItem('staff-portal-theme', theme);
        }
        
        function loadSavedPreferences() {
            const darkMode = localStorage.getItem(DARK_MODE_KEY) === 'true';
            const smallScreenMode = localStorage.getItem(SMALL_SCREEN_KEY) === 'true';
            const savedTheme = localStorage.getItem('staff-portal-theme');

            // Load saved theme if present
            if (savedTheme) {
                setActiveTheme(savedTheme);
            } 
            // Otherwise check system preference or legacy dark mode setting
            else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                setActiveTheme('dark');
            } else if (darkMode) {
                setActiveTheme('dark');
            }

            if (smallScreenMode) {
                smallScreenToggle.checked = true;
                document.body.classList.add('small-screen-mode');
            }

            // Check if we need to update if version has changed
            const savedVersion = localStorage.getItem('appVersion');
            if (savedVersion !== APP_VERSION) {
                localStorage.setItem('appVersion', APP_VERSION);
                if (savedVersion) {
                    // Show update notification only if this is not first install
                    showNotification(`Updated to version ${APP_VERSION}`, 'info');
                }
            }
        }

        // Initialize event listeners
        function initEventListeners() {
            // Theme buttons
            const lightThemeBtn = document.getElementById('light-theme-btn');
            const darkThemeBtn = document.getElementById('dark-theme-btn');
            const aaThemeBtn = document.getElementById('aa-theme-btn');
            
            if (lightThemeBtn && darkThemeBtn && aaThemeBtn) {
                // Set active theme from localStorage or default to light
                const savedTheme = localStorage.getItem('staff-portal-theme') || 'light';
                setActiveTheme(savedTheme);
                
                lightThemeBtn.addEventListener('click', function() {
                    setActiveTheme('light');
                });
                
                darkThemeBtn.addEventListener('click', function() {
                    setActiveTheme('dark');
                });
                
                aaThemeBtn.addEventListener('click', function() {
                    setActiveTheme('aa');
                });
            }
            
            // Legacy dark mode toggle - for backward compatibility
            if (darkModeToggle) {
                darkModeToggle.addEventListener('change', function() {
                    document.documentElement.classList.toggle('dark-mode');
                    localStorage.setItem(DARK_MODE_KEY, darkModeToggle.checked);
                });
            }

            // Small screen toggle
            smallScreenToggle.addEventListener('change', function() {
                document.body.classList.toggle('small-screen-mode');
                localStorage.setItem(SMALL_SCREEN_KEY, smallScreenToggle.checked);
            });

            // Flight tracker form
            flightTrackerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const flightNumber = document.getElementById('flight-number').value;
                const airlineCode = document.getElementById('airline-select').value;
                const trackingService = document.getElementById('tracking-service').value;

                if (!flightNumber) {
                    showNotification('Please enter a flight number', 'error');
                    return;
                }

                // Open FlightAware directly with the flight information
                const flightIdentifier = airlineCode + flightNumber;
                const flightAwareUrl = `https://flightaware.com/live/flight/${flightIdentifier}`;
                window.open(flightAwareUrl, '_blank');

                // Reset the form
                document.getElementById('flight-number').value = '';
                showNotification('Opening flight tracker in a new tab', 'success');
            });

            // Multi-engine search form
            if (multiSearchForm) {
                // Define search URLs for different engines
                const searchUrls = {
                    'google': (query) => `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                    'bing': (query) => `https://www.bing.com/search?q=${encodeURIComponent(query)}`,
                    'duckduckgo': (query) => `https://duckduckgo.com/?q=${encodeURIComponent(query)}`,
                    'aviation': (query) => `https://www.flightaware.com/search/?query=${encodeURIComponent(query)}`
                };
                
                // Define advanced options URLs
                const advancedOptionsUrls = {
                    'google': 'https://www.google.com/advanced_search',
                    'bing': 'https://www.bing.com/advanced',
                    'duckduckgo': 'https://duckduckgo.com/settings',
                    'aviation': 'https://www.flightaware.com/search/'
                };
                
                // Handle the main search form submission
                multiSearchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const searchQuery = document.getElementById('search-box').value;
    
                    if (!searchQuery) {
                        showNotification('Please enter a search query', 'error');
                        return;
                    }
                    
                    // Find all selected search engines
                    const selectedEngines = [];
                    document.querySelectorAll('input[name="search-engines"]:checked').forEach(input => {
                        selectedEngines.push(input.value);
                    });
                    
                    if (selectedEngines.length === 0) {
                        showNotification('Please select at least one search engine', 'error');
                        return;
                    }
                    
                    // If only one engine is selected, open it directly
                    if (selectedEngines.length === 1) {
                        const engine = selectedEngines[0];
                        window.open(searchUrls[engine](searchQuery), '_blank');
                        showNotification(`Searching with ${engine.charAt(0).toUpperCase() + engine.slice(1)}`, 'success');
                    } else {
                        // If multiple engines are selected, open the first one directly and the rest programmatically
                        window.open(searchUrls[selectedEngines[0]](searchQuery), '_blank');
                        
                        // Open the rest of the engines with a slight delay
                        for (let i = 1; i < selectedEngines.length; i++) {
                            setTimeout(() => {
                                window.open(searchUrls[selectedEngines[i]](searchQuery), '_blank');
                            }, i * 100);
                        }
                        
                        showNotification(`Searching with ${selectedEngines.length} engines`, 'success');
                    }
                });
                
                // Handle the "Open All Selected" button
                const openAllEnginesBtn = document.getElementById('open-all-engines');
                if (openAllEnginesBtn) {
                    openAllEnginesBtn.addEventListener('click', function() {
                        const searchQuery = document.getElementById('search-box').value;
                        
                        if (!searchQuery) {
                            showNotification('Please enter a search query', 'error');
                            return;
                        }
                        
                        // Find all selected search engines
                        const selectedEngines = [];
                        document.querySelectorAll('input[name="search-engines"]:checked').forEach(input => {
                            selectedEngines.push(input.value);
                        });
                        
                        if (selectedEngines.length === 0) {
                            showNotification('Please select at least one search engine', 'error');
                            return;
                        }
                        
                        // Open all selected search engines in new tabs
                        selectedEngines.forEach((engine, index) => {
                            setTimeout(() => {
                                window.open(searchUrls[engine](searchQuery), '_blank');
                            }, index * 100);
                        });
                        
                        showNotification(`Opened search in ${selectedEngines.length} engines`, 'success');
                    });
                }
                
                // Handle the "Advanced Options" button
                const openAdvOptionsBtn = document.getElementById('open-adv-options');
                if (openAdvOptionsBtn) {
                    openAdvOptionsBtn.addEventListener('click', function() {
                        // Find all selected search engines
                        const selectedEngines = [];
                        document.querySelectorAll('input[name="search-engines"]:checked').forEach(input => {
                            selectedEngines.push(input.value);
                        });
                        
                        if (selectedEngines.length === 0) {
                            showNotification('Please select at least one search engine', 'error');
                            return;
                        }
                        
                        // Open advanced options for all selected engines
                        selectedEngines.forEach((engine, index) => {
                            if (advancedOptionsUrls[engine]) {
                                setTimeout(() => {
                                    window.open(advancedOptionsUrls[engine], '_blank');
                                }, index * 100);
                            }
                        });
                        
                        showNotification('Opening advanced options', 'success');
                    });
                }
                
                // Ensure at least one search engine is always selected
                document.querySelectorAll('input[name="search-engines"]').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const anyChecked = Array.from(document.querySelectorAll('input[name="search-engines"]'))
                            .some(input => input.checked);
                        
                        if (!anyChecked) {
                            // If none are checked, recheck this one
                            this.checked = true;
                            showNotification('At least one search engine must be selected', 'info');
                        }
                    });
                });
            }

            // Airport info form
            airportInfoForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const airportCode = document.getElementById('airport-code').value.toUpperCase();

                if (!airportCode || airportCode.length !== 3) {
                    showNotification('Please enter a valid 3-letter airport code', 'error');
                    return;
                }
                
                // Show airport tabs
                document.getElementById('airport-tabs').classList.remove('hidden');
                
                // First load basic airport info
                loadAirportInfo(airportCode);
                
                // Reset active tab
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.tab-btn[data-tab="info"]').classList.add('active');
                
                // Show info tab, hide others
                document.getElementById('airport-info').classList.add('show');
                document.getElementById('airport-map').classList.add('hidden');
                document.getElementById('airport-gates').classList.add('hidden');
                
                // Also open FlightAware in a new tab
                const airportUrl = `https://flightaware.com/live/airport/${airportCode}`;
                window.open(airportUrl, '_blank');
            });
            
            // Airport tabs functionality
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    const airportCode = document.getElementById('airport-code').value.toUpperCase();
                    
                    // Update active tab
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Hide all content
                    document.getElementById('airport-info').classList.remove('show');
                    document.getElementById('airport-map').classList.add('hidden');
                    document.getElementById('airport-gates').classList.add('hidden');
                    
                    // Show selected content
                    if (tab === 'info') {
                        document.getElementById('airport-info').classList.add('show');
                    } else if (tab === 'map') {
                        document.getElementById('airport-map').classList.remove('hidden');
                        loadAirportMap(airportCode);
                    } else if (tab === 'gates') {
                        document.getElementById('airport-gates').classList.remove('hidden');
                        loadGateInfo(airportCode);
                    }
                });
            });
            
            // Load airport information
            function loadAirportInfo(code) {
                const infoContainer = document.getElementById('airport-info');
                infoContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner fa-pulse"></i>
                        <div class="loading-text">Loading airport information...</div>
                    </div>
                `;
                
                // Airport information mapping (in a real app, this would come from an API)
                const airports = {
                    'DFW': {
                        name: 'Dallas/Fort Worth International Airport',
                        location: 'Dallas-Fort Worth, TX, USA',
                        timezone: 'America/Chicago (UTC-5)',
                        terminals: 'A, B, C, D, E',
                        info: 'Hub for American Airlines'
                    },
                    'LAX': {
                        name: 'Los Angeles International Airport',
                        location: 'Los Angeles, CA, USA',
                        timezone: 'America/Los_Angeles (UTC-7)',
                        terminals: '1-8, TBIT',
                        info: 'Major international gateway'
                    },
                    'JFK': {
                        name: 'John F. Kennedy International Airport',
                        location: 'New York, NY, USA',
                        timezone: 'America/New_York (UTC-4)',
                        terminals: '1, 2, 4, 5, 7, 8',
                        info: 'Major international gateway for eastern US'
                    },
                    'LHR': {
                        name: 'London Heathrow Airport',
                        location: 'London, UK',
                        timezone: 'Europe/London (UTC+1)',
                        terminals: '2, 3, 4, 5',
                        info: 'One of the busiest airports globally'
                    }
                };
                
                // Simulate loading
                setTimeout(() => {
                    const airport = airports[code] || {
                        name: `${code} Airport`,
                        location: 'Location information not available',
                        timezone: 'Timezone information not available',
                        terminals: 'Terminal information not available',
                        info: 'No additional information available'
                    };
                    
                    infoContainer.innerHTML = `
                        <div class="airport-header">
                            <h3 class="airport-title">${airport.name} <span class="airport-code">(${code})</span></h3>
                        </div>
                        <div class="airport-details">
                            <div class="airport-detail-row">
                                <div class="detail-label"><i class="fas fa-map-marker-alt"></i> Location:</div>
                                <div class="detail-value">${airport.location}</div>
                            </div>
                            <div class="airport-detail-row">
                                <div class="detail-label"><i class="fas fa-clock"></i> Timezone:</div>
                                <div class="detail-value">${airport.timezone}</div>
                            </div>
                            <div class="airport-detail-row">
                                <div class="detail-label"><i class="fas fa-building"></i> Terminals:</div>
                                <div class="detail-value">${airport.terminals}</div>
                            </div>
                            <div class="airport-detail-row">
                                <div class="detail-label"><i class="fas fa-info-circle"></i> Notes:</div>
                                <div class="detail-value">${airport.info}</div>
                            </div>
                        </div>
                        <div class="airport-actions">
                            <a href="https://flightaware.com/live/airport/${code}" target="_blank" class="airport-link">
                                <i class="fas fa-external-link-alt"></i> View on FlightAware
                            </a>
                        </div>
                    `;
                }, 1000);
            }
            
            // Load airport terminal map
            function loadAirportMap(code) {
                const mapContainer = document.querySelector('.map-container');
                mapContainer.innerHTML = `
                    <div class="loading">
                        <i class="fas fa-spinner fa-pulse"></i>
                        <div class="loading-text">Loading terminal map...</div>
                    </div>
                `;
                
                // Maps for common airports
                const maps = {
                    'DFW': 'https://www.dfwairport.com/map/',
                    'LAX': 'https://www.flylax.com/en/terminal-maps',
                    'JFK': 'https://www.jfkairport.com/at-airport/airport-maps',
                    'LHR': 'https://www.heathrow.com/at-the-airport/terminal-guides'
                };
                
                // Simulate loading
                setTimeout(() => {
                    if (maps[code]) {
                        mapContainer.innerHTML = `
                            <div class="terminal-map-info">
                                <p>Terminal maps for ${code} are available on the official airport website.</p>
                                <a href="${maps[code]}" target="_blank" class="map-link">
                                    <i class="fas fa-external-link-alt"></i> View Interactive Airport Map
                                </a>
                            </div>
                        `;
                    } else {
                        mapContainer.innerHTML = `
                            <div class="terminal-map-info no-map">
                                <i class="fas fa-map"></i>
                                <p>No terminal map is available for ${code}.</p>
                                <p>Try searching for "${code} airport map" on Google.</p>
                            </div>
                        `;
                    }
                }, 1000);
            }
            
            // Load gate information
            function loadGateInfo(code) {
                const gatesContainer = document.querySelector('.gates-list');
                const loadingGates = document.querySelector('.loading-gates');
                
                // Show loading
                loadingGates.classList.remove('hidden');
                gatesContainer.innerHTML = '';
                
                // Example gate data (in a real app, this would come from an API)
                const gateData = {
                    'DFW': [
                        { terminal: 'A', gate: 'A12', airlines: 'American Airlines', status: 'Active' },
                        { terminal: 'A', gate: 'A23', airlines: 'American Airlines', status: 'Active' },
                        { terminal: 'C', gate: 'C10', airlines: 'American Airlines', status: 'Active' },
                        { terminal: 'D', gate: 'D15', airlines: 'American Airlines', status: 'Active' }
                    ],
                    'LAX': [
                        { terminal: '4', gate: '42A', airlines: 'American Airlines', status: 'Active' },
                        { terminal: '5', gate: '51B', airlines: 'Delta Airlines', status: 'Active' },
                        { terminal: 'TBIT', gate: '130', airlines: 'International', status: 'Active' }
                    ],
                    'JFK': [
                        { terminal: '1', gate: '1A', airlines: 'International', status: 'Active' },
                        { terminal: '8', gate: '8C', airlines: 'American Airlines', status: 'Active' }
                    ]
                };
                
                // Simulate API loading delay
                setTimeout(() => {
                    loadingGates.classList.add('hidden');
                    
                    if (gateData[code]) {
                        gateData[code].forEach(gate => {
                            const gateItem = document.createElement('div');
                            gateItem.className = 'gate-item';
                            gateItem.innerHTML = `
                                <div class="gate-terminal">${gate.terminal}</div>
                                <div class="gate-info">
                                    <div class="gate-title">Gate ${gate.gate}</div>
                                    <div class="gate-details">${gate.airlines} | ${gate.status}</div>
                                </div>
                            `;
                            gatesContainer.appendChild(gateItem);
                        });
                    } else {
                        gatesContainer.innerHTML = `
                            <div class="no-gate-data">
                                <p>No gate information is available for ${code}.</p>
                                <a href="https://flightaware.com/live/airport/${code}" target="_blank">
                                    View on FlightAware for more information
                                </a>
                            </div>
                        `;
                    }
                }, 1500);
            }

            // Add link button
            addLinkBtn.addEventListener('click', function(e) {
                e.preventDefault();
                openAddLinkModal();
            });

            // Close modals
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.remove('show');
                    });
                });
            });

            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                    }
                });
                
                // Also close context menu when clicking elsewhere
                if (contextMenu.classList.contains('show') && !contextMenu.contains(e.target)) {
                    contextMenu.classList.remove('show');
                }
            });

            // Add link form
            addLinkForm.addEventListener('submit', function(e) {
                e.preventDefault();
                addCustomLink();
            });

            // Edit link form
            editLinkForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveEditedLink();
            });

            // Update badge click handler
            document.getElementById('update-available').addEventListener('click', function() {
                // Force reload from server, not cache
                window.location.reload(true);
            });

            // Context menu edit button
            editLinkBtn.addEventListener('click', function() {
                if (currentCustomLinkElement) {
                    openEditLinkModal(currentCustomLinkElement);
                }
                contextMenu.classList.remove('show');
            });

            // Context menu delete button
            deleteLinkBtn.addEventListener('click', function() {
                if (currentCustomLinkElement) {
                    const linkId = currentCustomLinkElement.dataset.id;
                    const linkName = currentCustomLinkElement.querySelector('span').textContent;
                    
                    if (confirm(`Remove "${linkName}" from your quick links?`)) {
                        removeCustomLink(linkId);
                        currentCustomLinkElement.remove();
                        showNotification('Link removed successfully', 'success');
                    }
                }
                contextMenu.classList.remove('show');
            });

            // Prevent default context menu on custom links
            document.addEventListener('contextmenu', function(e) {
                const linkItem = e.target.closest('.link-item[data-id]');
                if (linkItem) {
                    e.preventDefault();
                    showContextMenu(e, linkItem);
                }
            });

            // Long press for mobile devices
            let longPressTimer;
            const longPressDuration = 500; // 500ms for long press

            document.addEventListener('touchstart', function(e) {
                const linkItem = e.target.closest('.link-item[data-id]');
                if (linkItem) {
                    longPressTimer = setTimeout(() => {
                        e.preventDefault();
                        showContextMenu(e, linkItem);
                    }, longPressDuration);
                }
            });

            document.addEventListener('touchend', function() {
                clearTimeout(longPressTimer);
            });

            document.addEventListener('touchmove', function() {
                clearTimeout(longPressTimer);
            });
        }

        // Show context menu for custom links
        function showContextMenu(e, linkElement) {
            // Set the current link element
            currentCustomLinkElement = linkElement;
            
            // Position the context menu
            const x = e.clientX || e.touches[0].clientX;
            const y = e.clientY || e.touches[0].clientY;
            
            contextMenu.style.left = `${x}px`;
            contextMenu.style.top = `${y}px`;
            
            // Show the menu
            contextMenu.classList.add('show');
        }

        // Open edit link modal
        function openEditLinkModal(linkElement) {
            const linkId = linkElement.dataset.id;
            const linkName = linkElement.querySelector('span').textContent;
            const linkUrl = linkElement.href;
            const linkIcon = linkElement.querySelector('i').className.split(' ')[1];
            
            document.getElementById('edit-link-id').value = linkId;
            document.getElementById('edit-link-name').value = linkName;
            document.getElementById('edit-link-url').value = linkUrl;
            document.getElementById('edit-link-icon').value = linkIcon;
            
            document.getElementById('edit-link-modal').classList.add('show');
        }

        // Save edited link
        function saveEditedLink() {
            const id = document.getElementById('edit-link-id').value;
            const name = document.getElementById('edit-link-name').value.trim();
            const url = document.getElementById('edit-link-url').value.trim();
            const icon = document.getElementById('edit-link-icon').value;

            if (!name || !url) {
                showNotification('Please fill out all fields', 'error');
                return;
            }

            // Validate URL format
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showNotification('URL must start with http:// or https://', 'error');
                return;
            }

            // Update link in localStorage
            try {
                const customLinks = JSON.parse(localStorage.getItem(CUSTOM_LINKS_KEY)) || [];
                const updatedLinks = customLinks.map(link => {
                    if (link.id === id) {
                        return { ...link, name, url, icon };
                    }
                    return link;
                });
                
                localStorage.setItem(CUSTOM_LINKS_KEY, JSON.stringify(updatedLinks));

                // Update in DOM
                const linkElement = document.querySelector(`.link-item[data-id="${id}"]`);
                if (linkElement) {
                    linkElement.href = url;
                    linkElement.querySelector('i').className = `fas ${icon}`;
                    linkElement.querySelector('span').textContent = name;
                }

                // Hide modal
                document.getElementById('edit-link-modal').classList.remove('show');
                showNotification('Link updated successfully', 'success');
            } catch (error) {
                console.error('Error updating link:', error);
                showNotification('Error updating link', 'error');
            }
        }

        // Load custom links from localStorage
        function loadCustomLinks() {
            try {
                const customLinks = JSON.parse(localStorage.getItem(CUSTOM_LINKS_KEY)) || [];

                // Add custom links to the grid before the "Add Link" button
                customLinks.forEach(link => {
                    addLinkToDOM(link);
                });
            } catch (error) {
                console.error('Error loading custom links:', error);
                showNotification('Error loading your custom links', 'error');
            }
        }

        // Add a custom link to the DOM
        function addLinkToDOM(link) {
            const linkElement = document.createElement('a');
            linkElement.href = link.url;
            linkElement.className = 'link-item';
            linkElement.target = '_blank';
            linkElement.dataset.id = link.id;
            linkElement.rel = 'noopener noreferrer';

            linkElement.innerHTML = `
                <i class="fas ${link.icon}"></i>
                <span>${link.name}</span>
            `;

            // Add the link before the "Add Link" button
            const quickLinksContainer = document.getElementById('quick-links-container');
            quickLinksContainer.insertBefore(linkElement, addLinkBtn);
        }

        // Open the add link modal
        function openAddLinkModal() {
            document.getElementById('add-link-modal').classList.add('show');
            document.getElementById('link-name').focus();
        }

        // Add a custom link
        function addCustomLink() {
            const name = document.getElementById('link-name').value.trim();
            const url = document.getElementById('link-url').value.trim();
            const icon = document.getElementById('link-icon').value;

            if (!name || !url) {
                showNotification('Please fill out all fields', 'error');
                return;
            }

            // Validate URL format
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showNotification('URL must start with http:// or https://', 'error');
                return;
            }

            // Create link object
            const newLink = {
                id: Date.now().toString(),
                name,
                url,
                icon
            };

            // Save to localStorage
            try {
                const customLinks = JSON.parse(localStorage.getItem(CUSTOM_LINKS_KEY)) || [];
                customLinks.push(newLink);
                localStorage.setItem(CUSTOM_LINKS_KEY, JSON.stringify(customLinks));

                // Add to DOM
                addLinkToDOM(newLink);

                // Close modal
                document.getElementById('add-link-modal').classList.remove('show');
                addLinkForm.reset();

                showNotification('Link added successfully', 'success');
            } catch (error) {
                console.error('Error saving custom link:', error);
                showNotification('Error saving link', 'error');
            }
        }

        // Remove a custom link
        function removeCustomLink(id) {
            try {
                const customLinks = JSON.parse(localStorage.getItem(CUSTOM_LINKS_KEY)) || [];
                const updatedLinks = customLinks.filter(link => link.id !== id);
                localStorage.setItem(CUSTOM_LINKS_KEY, JSON.stringify(updatedLinks));
            } catch (error) {
                console.error('Error removing custom link:', error);
                showNotification('Error removing link', 'error');
            }
        }

        // Update online status
        function updateOnlineStatus() {
            if (navigator.onLine) {
                document.body.classList.remove('offline');
                // If coming back online, check if we need to sync
                if (window.serviceWorkerRegistration && navigator.serviceWorker.controller) {
                    navigator.serviceWorker.controller.postMessage({
                        type: 'ONLINE_AGAIN'
                    });
                }
            } else {
                document.body.classList.add('offline');
                showNotification('You are now offline. Some features may be limited.', 'warning');
            }
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            
            // Set icon based on type
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
                default:
                    icon = '<i class="fas fa-info-circle"></i>';
            }
            
            notification.innerHTML = `${icon} ${message}`;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('show');

            // Remove the notification after delay
            clearTimeout(window.notificationTimeout);
            window.notificationTimeout = setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Display flight information (simulated)
        function displayFlightInfo(airlineCode, flightNumber, trackingService) {
            // In a real app, this would fetch actual flight data from an API
            // For this demo, we're creating a simulated UI
            
            // Get airline name from code
            const airlines = {
                'AAL': 'American Airlines',
                'DAL': 'Delta Air Lines',
                'UAL': 'United Airlines',
                'SWA': 'Southwest Airlines',
                'JBU': 'JetBlue Airways',
                'ASA': 'Alaska Airlines',
                'FFT': 'Frontier Airlines',
                'NKS': 'Spirit Airlines'
            };
            
            const airlineName = airlines[airlineCode] || airlineCode;
            
            // Create random flight data for demonstration
            const status = ['On Time', 'Delayed', 'Boarding', 'In Air', 'Landed'][Math.floor(Math.random() * 5)];
            const originCode = ['DFW', 'LAX', 'JFK', 'ORD', 'ATL', 'MIA'][Math.floor(Math.random() * 6)];
            const destinationCode = ['SFO', 'BOS', 'SEA', 'DEN', 'LAS', 'MCO'][Math.floor(Math.random() * 6)];
            const departureTime = Math.floor(Math.random() * 23) + ':' + (Math.floor(Math.random() * 59)).toString().padStart(2, '0');
            const arrivalTime = Math.floor(Math.random() * 23) + ':' + (Math.floor(Math.random() * 59)).toString().padStart(2, '0');
            const aircraft = ['Boeing 737-800', 'Airbus A321', 'Boeing 787-9', 'Airbus A319', 'Boeing 777-200'][Math.floor(Math.random() * 5)];
            
            // Get tracking URL
            let trackingUrl;
            if (trackingService === 'flightaware') {
                trackingUrl = `https://flightaware.com/live/flight/${airlineCode}${flightNumber}`;
            } else if (trackingService === 'flightradar24') {
                trackingUrl = `https://www.flightradar24.com/data/flights/${airlineCode.toLowerCase()}${flightNumber}`;
            } else {
                trackingUrl = `https://www.flightview.com/flight-tracker/${airlineCode}/${flightNumber}`;
            }
            
            // Build the flight info display
            let statusClass = '';
            let statusIcon = '';
            
            switch(status) {
                case 'On Time':
                    statusClass = 'success';
                    statusIcon = 'fa-check-circle';
                    break;
                case 'Delayed':
                    statusClass = 'error';
                    statusIcon = 'fa-exclamation-circle';
                    break;
                case 'Boarding':
                    statusClass = 'warning';
                    statusIcon = 'fa-door-open';
                    break;
                case 'In Air':
                    statusClass = 'info';
                    statusIcon = 'fa-plane';
                    break;
                case 'Landed':
                    statusClass = 'success';
                    statusIcon = 'fa-plane-arrival';
                    break;
            }
            
            const flightInfoHTML = `
                <div class="flight-header">
                    <div class="flight-title">${airlineName} <span class="flight-number">${flightNumber}</span></div>
                    <div class="flight-status-badge ${statusClass}">
                        <i class="fas ${statusIcon}"></i> ${status}
                    </div>
                </div>
                <div class="flight-data">
                    <div class="flight-info">
                        <div class="flight-info-label">Origin</div>
                        <div class="flight-info-value">${originCode}</div>
                    </div>
                    <div class="flight-info">
                        <div class="flight-info-label">Destination</div>
                        <div class="flight-info-value">${destinationCode}</div>
                    </div>
                    <div class="flight-info">
                        <div class="flight-info-label">Departure</div>
                        <div class="flight-info-value">${departureTime}</div>
                    </div>
                    <div class="flight-info">
                        <div class="flight-info-label">Arrival</div>
                        <div class="flight-info-value">${arrivalTime}</div>
                    </div>
                    <div class="flight-info" style="grid-column: 1 / -1;">
                        <div class="flight-info-label">Aircraft</div>
                        <div class="flight-info-value">${aircraft}</div>
                    </div>
                </div>
                <div class="flight-actions">
                    <a href="${trackingUrl}" target="_blank" rel="noopener noreferrer" class="btn-primary">
                        <i class="fas fa-external-link-alt"></i> View Details
                    </a>
                </div>
            `;
            
            flightStatusContainer.innerHTML = flightInfoHTML;
            flightStatusContainer.classList.add('show');
            
            // Scroll to show the flight info
            setTimeout(() => {
                flightStatusContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Display airport information (simulated)
        function displayAirportInfo(airportCode) {
            // In a real app, this would fetch actual airport data from an API
            // For this demo, we're creating a simulated UI
            
            // Sample airport data for common airports
            const airportData = {
                'DFW': {
                    name: 'Dallas/Fort Worth International Airport',
                    city: 'Dallas-Fort Worth',
                    state: 'TX',
                    country: 'USA',
                    elevation: '607 ft',
                    weatherTemp: '78F',
                    weatherCondition: 'Mostly Sunny',
                    weatherIcon: 'fa-sun'
                },
                'JFK': {
                    name: 'John F. Kennedy International Airport',
                    city: 'New York',
                    state: 'NY',
                    country: 'USA',
                    elevation: '13 ft',
                    weatherTemp: '65F',
                    weatherCondition: 'Partly Cloudy',
                    weatherIcon: 'fa-cloud-sun'
                },
                'LAX': {
                    name: 'Los Angeles International Airport',
                    city: 'Los Angeles',
                    state: 'CA',
                    country: 'USA',
                    elevation: '128 ft',
                    weatherTemp: '72F',
                    weatherCondition: 'Clear',
                    weatherIcon: 'fa-sun'
                },
                'ORD': {
                    name: 'O\'Hare International Airport',
                    city: 'Chicago',
                    state: 'IL',
                    country: 'USA',
                    elevation: '668 ft',
                    weatherTemp: '56F',
                    weatherCondition: 'Windy',
                    weatherIcon: 'fa-wind'
                },
                'ATL': {
                    name: 'Hartsfield-Jackson Atlanta International Airport',
                    city: 'Atlanta',
                    state: 'GA',
                    country: 'USA',
                    elevation: '1,026 ft',
                    weatherTemp: '82F',
                    weatherCondition: 'Thunderstorms',
                    weatherIcon: 'fa-cloud-bolt'
                },
                'SFO': {
                    name: 'San Francisco International Airport',
                    city: 'San Francisco',
                    state: 'CA',
                    country: 'USA',
                    elevation: '13 ft',
                    weatherTemp: '62F',
                    weatherCondition: 'Foggy',
                    weatherIcon: 'fa-smog'
                }
            };
            
            // Default airport data for unknown codes
            const defaultAirport = {
                name: `${airportCode} Airport`,
                city: 'Unknown',
                state: '',
                country: 'Unknown',
                elevation: 'Unknown',
                weatherTemp: '--F',
                weatherCondition: 'Information Not Available',
                weatherIcon: 'fa-question'
            };
            
            // Get the airport data or use default
            const airport = airportData[airportCode] || defaultAirport;
            
            // Get FlightAware link
            const flightAwareUrl = `https://flightaware.com/live/airport/${airportCode}`;
            
            // Build the airport info display
            const airportInfoHTML = `
                <div class="airport-header">
                    <div class="airport-title">
                        <span class="airport-code">${airportCode}</span>
                    </div>
                    <div>${airport.name}</div>
                </div>
                <div class="airport-data">
                    <div class="airport-weather">
                        <i class="fas ${airport.weatherIcon}"></i>
                        <div class="airport-weather-details">
                            <div class="weather-temp">${airport.weatherTemp}</div>
                            <div class="weather-condition">${airport.weatherCondition}</div>
                        </div>
                    </div>
                    <div class="airport-info-item">
                        <div class="airport-info-label">City</div>
                        <div class="airport-info-value">${airport.city}</div>
                    </div>
                    <div class="airport-info-item">
                        <div class="airport-info-label">State/Country</div>
                        <div class="airport-info-value">${airport.state} ${airport.country}</div>
                    </div>
                    <div class="airport-info-item">
                        <div class="airport-info-label">Elevation</div>
                        <div class="airport-info-value">${airport.elevation}</div>
                    </div>
                    <div class="airport-info-item">
                        <div class="airport-info-label">Local Time</div>
                        <div class="airport-info-value" id="airport-local-time">${new Date().toLocaleTimeString()}</div>
                    </div>
                </div>
                <div class="airport-actions">
                    <a href="${flightAwareUrl}" target="_blank" rel="noopener noreferrer" class="btn-primary">
                        <i class="fas fa-external-link-alt"></i> View on FlightAware
                    </a>
                </div>
            `;
            
            airportInfoContainer.innerHTML = airportInfoHTML;
            airportInfoContainer.classList.add('show');
            
            // Scroll to show the airport info
            setTimeout(() => {
                airportInfoContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        // Create and Register Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                // Create the Service Worker content
                const swContent = `
                    // Service Worker for Airline Staff Portal PWA
                    const CACHE_NAME = '${CACHE_VERSION}';
                    const APP_SHELL = [
                        './',
                        './index.html',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2'
                    ];

                    // Install event handler - cache the app shell
                    self.addEventListener('install', event => {
                        console.log('[Service Worker] Installing Service Worker...');
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    console.log('[Service Worker] Caching App Shell');
                                    return cache.addAll(APP_SHELL);
                                })
                                .then(() => {
                                    console.log('[Service Worker] Successfully installed');
                                    return self.skipWaiting();
                                })
                        );
                    });

                    // Activate event handler - clean up old caches
                    self.addEventListener('activate', event => {
                        console.log('[Service Worker] Activating Service Worker...');
                        event.waitUntil(
                            caches.keys()
                                .then(keyList => {
                                    return Promise.all(keyList.map(key => {
                                        if (key !== CACHE_NAME) {
                                            console.log('[Service Worker] Removing old cache', key);
                                            return caches.delete(key);
                                        }
                                    }));
                                })
                                .then(() => {
                                    console.log('[Service Worker] Claiming clients');
                                    return self.clients.claim();
                                })
                        );
                        return self.clients.claim();
                    });

                    // Fetch event handler - serve from cache, fallback to network
                    self.addEventListener('fetch', event => {
                        // Skip cross-origin requests
                        if (!event.request.url.startsWith(self.location.origin) && 
                            !event.request.url.includes('cdnjs.cloudflare.com')) {
                            return;
                        }
                        
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        // Return cached response
                                        return response;
                                    }
                                    
                                    // If not in cache, fetch from network
                                    return fetch(event.request)
                                        .then(networkResponse => {
                                            // Don't cache third-party resources
                                            if (!event.request.url.includes('google.com') && 
                                                !event.request.url.includes('flightaware.com') && 
                                                !event.request.url.includes('flightradar24.com') &&
                                                !event.request.url.includes('flightview.com')) {
                                                // Clone the response before using it
                                                const responseToCache = networkResponse.clone();
                                                caches.open(CACHE_NAME)
                                                    .then(cache => {
                                                        cache.put(event.request, responseToCache);
                                                    })
                                                    .catch(err => {
                                                        console.error('[Service Worker] Error caching response:', err);
                                                    });
                                            }
                                            return networkResponse;
                                        })
                                        .catch(err => {
                                            console.error('[Service Worker] Fetch error:', err);
                                            // For navigation requests, return the offline page
                                            if (event.request.mode === 'navigate') {
                                                return caches.match('./index.html');
                                            }
                                            // Return a default response for other requests
                                            return new Response('Network unavailable', {
                                                status: 503,
                                                statusText: 'Service Unavailable',
                                                headers: new Headers({
                                                    'Content-Type': 'text/plain'
                                                })
                                            });
                                        });
                                })
                                .catch(err => {
                                    console.error('[Service Worker] Cache match error:', err);
                                    return fetch(event.request);
                                })
                        );
                    });

                    // Handle messages from clients
                    self.addEventListener('message', event => {
                        if (event.data && event.data.action === 'skipWaiting') {
                            self.skipWaiting();
                        }
                        
                        if (event.data && event.data.type === 'ONLINE_AGAIN') {
                            console.log('[Service Worker] App is online again, syncing...');
                            // Here we could sync any pending changes
                        }
                    });
                    
                    // Push notification support
                    self.addEventListener('push', event => {
                        let notification = {
                            title: 'Airline Staff Portal',
                            body: 'New information available',
                            icon: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSIjMDA2M2M2IiBkPSJNNTAsMTBMOTAsOTBIMTBMNTAsMTB6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCw3NWwtMjUtMTBoNTBMNTAsNzV6Ii8+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik01MCwyNWwxNSw0NUg2NWwtMTUtNDV6Ii8+PC9zdmc+'
                        };

                        if (event.data) {
                            try {
                                const data = event.data.json();
                                notification = {
                                    ...notification,
                                    ...data
                                };
                            } catch (e) {
                                console.error('[Service Worker] Push event parse error:', e);
                            }
                        }

                        event.waitUntil(
                            self.registration.showNotification(notification.title, {
                                body: notification.body,
                                icon: notification.icon,
                                badge: notification.icon,
                                data: notification.data || {}
                            })
                        );
                    });

                    // Notification click event
                    self.addEventListener('notificationclick', event => {
                        event.notification.close();
                        
                        const urlToOpen = event.notification.data && event.notification.data.url 
                            ? event.notification.data.url 
                            : self.location.origin;

                        event.waitUntil(
                            clients.matchAll({type: 'window'}).then(windowClients => {
                                // Check if there is already a window open with the URL
                                for (let client of windowClients) {
                                    if (client.url === urlToOpen && 'focus' in client) {
                                        return client.focus();
                                    }
                                }
                                // If not, open a new window
                                if (clients.openWindow) {
                                    return clients.openWindow(urlToOpen);
                                }
                            })
                        );
                    });
                `;

                // Create a blob from the service worker content
                const swBlob = new Blob([swContent], {type: 'application/javascript'});

                // Create a URL for the blob
                const swURL = URL.createObjectURL(swBlob);

                // Register the service worker using the blob URL
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register(swURL)
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                            window.serviceWorkerRegistration = registration;

                            // Check for updates
                            registration.addEventListener('updatefound', () => {
                                const newWorker = registration.installing;
                                console.log('Service Worker update found!');
                                document.getElementById('update-available').classList.remove('hidden');

                                // Reload to update when clicked
                                document.getElementById('update-available').addEventListener('click', () => {
                                    if (newWorker) {
                                        newWorker.postMessage({ action: 'skipWaiting' });
                                    }
                                    window.location.reload();
                                });
                            });

                            // Handle service worker updates
                            navigator.serviceWorker.addEventListener('controllerchange', () => {
                                console.log('Service Worker controller changed!');
                            });
                        })
                        .catch(error => {
                            console.error('Service Worker registration failed:', error);
                        });
                });
            }
        }

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
